"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(){function e(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function a(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function t(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var r=function(){function e(t){a(this,e),this.hash=Lampa.Utils.hash(t.movie.original_title),this.field="online_selected_voice"}return n(e,[{key:"get",value:function(){return Lampa.Storage.get(this.field,"{}")[this.hash]||""}},{key:"set",value:function(e){var a=Lampa.Storage.get(this.field,"{}");a[this.hash]=e,Lampa.Storage.set(this.field,a)}}]),e}();function o(e){this.data={},this.work=0,this.need=e,this.complited=!1,this.check=function(){this.stopped||this.work>=this.need&&!this.complited&&(this.complited=!0,this.onComplite(this.data))},this.next=function(){this.work++,this.check()},this.append=function(e,a){this.work++,this.data[e]=a,this.check()},this.error=function(){this.work++,this.check()},this.stop=function(){this.stopped=!0}}var l={cache:{},pending:{},getCache:function(){return window.SEASON_FIX&&window.SEASON_FIX.tvmaze_cache?window.SEASON_FIX.tvmaze_cache:this.cache},getSeasonsCount:function(e){var a=this.getCache()[e];return a&&"object"===_typeof(a)&&Object.keys(a).length>0?Object.keys(a).length:null},fetch:function(e,a,t,n){var i=this,r=this.getCache();if(r[e]&&"object"===_typeof(r[e]))n&&n(Object.keys(r[e]).length);else if("loading"===r[e]||this.pending[e])n&&(this.pending[e]||(this.pending[e]=[]),this.pending[e].push(n));else{r[e]="loading",n&&(this.pending[e]=[n]);a||t?this.fetchFromTvmaze(e,a,t):this.fetchExternalIds(e,(function(a){a&&(a.imdb_id||a.tvdb_id)?i.fetchFromTvmaze(e,a.imdb_id,a.tvdb_id):i.finishPending(e,null)}))}},fetchExternalIds:function(e,a){var t=Lampa.TMDB&&Lampa.TMDB.key?Lampa.TMDB.key():null;if(t){var n=Lampa.TMDB&&Lampa.TMDB.api?Lampa.TMDB.api("tv/"+e+"/external_ids?api_key="+t):"https://api.themoviedb.org/3/tv/"+e+"/external_ids?api_key="+t;this.request(n,a)}else a(null)},fetchFromTvmaze:function(e,a,t){var n=this,i=a||t;if(i){var r="https://api.tvmaze.com/lookup/shows?"+(a?"imdb":"thetvdb")+"="+i;this.request(r,(function(a){if(a&&a.id){var t="https://api.tvmaze.com/shows/"+a.id+"/episodes";n.request(t,(function(a){if(a&&a.length){for(var t={},i=0;i<a.length;i++){var r=a[i].season;t[r]||(t[r]=0),t[r]++}var o=n.getCache();Object.keys(t).length>0?(o[e]=t,n.finishPending(e,Object.keys(t).length)):(delete o[e],n.finishPending(e,null))}else n.finishPending(e,null)}))}else n.finishPending(e,null)}))}else this.finishPending(e,null)},finishPending:function(e,a){var t=this.getCache();"loading"===t[e]&&delete t[e];var n=this.pending[e];delete this.pending[e],n&&n.length&&n.forEach((function(e){e(a)}))},request:function(e,a){var t=new Lampa.Reguest;t.timeout(1e4);var n=function(e){a(e)},i=function(){a(null)};-1!==e.indexOf("themoviedb.org")||-1!==e.indexOf("apitmdb.")?t.silent(e,n,i):t.native(e,n,i)}},s=["Анастасия Гайдаржи + Андрей Юрченко","Студии Суверенного Лепрозория","IgVin &amp; Solncekleshka","Студия Пиратского Дубляжа","Gremlin Creative Studio","Alternative Production","Bubble Dubbing Company","HelloMickey Production","Н.Севастьянов seva1988","XDUB Dorama + Колобок","Мобильное телевидение","СПД - Сладкая парочка","BBC Saint-Petersburg","Black Street Records","Intra Communications","Melodic Voice Studio","Selena International","Voice Project Studio","Несмертельное оружие","Петербургский дубляж","Asian Miracle Group","Lizard Cinema Trade","National Geographic","Studio Victory Аsia","True Dubbing Studio","Позитив-Мультимедиа","Премьер Мультимедиа","Уолт Дисней Компани","Family Fan Edition","Paramount Pictures","Parovoz Production","Shadow Dub Project","The Kitchen Russia","Zone Vision Studio","Анастасия Гайдаржи","Иванова и П. Пашут","Малиновский Сергей","Так Треба Продакшн","Back Board Cinema","Paramount Channel","Project Web Mania","RedDiamond Studio","Universal Channel","Zoomvision Studio","НеЗупиняйПродакшн","Селена Интернешнл","Студия «Стартрек»","Хихикающий доктор","Четыре в квадрате","Brain Production","Cowabunga Studio","Lucky Production","MC Entertainment","Paramount Comedy","Universal Russia","Анатолий Ашмарин","Андрей Питерский","Васька Куролесов","Екатеринбург Арт","Квадрат Малевича","Первый канал ОРТ","Реальный перевод","Русский Репортаж","Сolumbia Service","Amazing Dubbing","AnimeSpace Team","Cartoon Network","Cinema Prestige","CinemaSET GROUP","DeadLine Studio","DeeAFilm Studio","GreenРай Studio","New Dream Media","Sunshine Studio","Volume-6 Studio","XvidClub Studio","Антонов Николай","Воробьев Сергей","Денис Шадинский","З Ранку До Ночі","Максим Логинофф","Николай Дроздов","Студия Горького","Студийная банда","Ульпаней Эльром","Agatha Studdio","Anything-group","CrazyCatStudio","Creative Sound","DIVA Universal","Garsu Pasaulis","GoodTime Media","Goodtime Media","Hamster Studio","Horizon Studio","Jakob Bellmann","Julia Prosenuk","KosharaSerials","Kulzvuk Studio","Mallorn Studio","Red Head Sound","RedRussian1337","SovetRomantica","SunshineStudio","Syfy Universal","TUMBLER Studio","Viasat History","visanti-vasaer","Анатолий Гусев","Вартан Дохалов","Витя «говорун»","Кирдин | Stalk","Л. Володарский","Леша Прапорщик","Максим Жолобов","Медиа-Комплекс","Прайд Продакшн","Русский дубляж","Союзмультфильм","Студия Колобок","5-й канал СПб","ARRU Workshop","Arasi project","Banyan Studio","Bars MacAdams","Bonsai Studio","Byako Records","Dream Records","FiliZa Studio","Filiza Studio","Film Prestige","Flarrow Films","Gezell Studio","Greb&Creative","HamsterStudio","Jetvis Studio","LE-Production","Lizard Cinema","Nazel & Freya","PCB Translate","Rainbow World","Renegade Team","SHIZA Project","Sci-Fi Russia","Amanogawa","The Mike Rec.","VIP Serial HD","VO-Production","VO-production","Victory-Films","ViruseProject","Voice Project","Vulpes Vulpes","АРК-ТВ Studio","Видеопродакшн","Мадлен Дюваль","Мика Бондарик","Наталья Гурзо","Премьер Видео","Семыкина Юлия","Старый Бильбо","Трамвай-фильм","Фортуна-Фильм","Хоррор Мэйкер","Храм Дорам ТВ","Штамп Дмитрий","A. Lazarchuk","AlphaProject","AniLibria.TV","AnimeReactor","Animereactor","BadCatStudio","DreamRecords","General Film","HaseRiLLoPaW","Horror Maker","Ivnet Cinema","Korean Craze","Light Breeze","Mystery Film","Oneinchnales","Profix Media","Psychotronic","RG Paravozik","RG.Paravozik","RussianGuy27","Sony Channel","Train Studio","Trdlo.studio","ViP Premiere","VictoryFilms","VulpesVulpes","Wayland team","sweet couple","Альтера Парс","Видеоимпульс","Гей Кино Гид","Говинда Рага","Деваль Видео","Е. Хрусталёв","К. Поздняков","Кармен Видео","Кинопремьера","Кирилл Сагач","КонтентикOFF","Кубик в Кубе","Кураж-Бамбей","Мьюзик-трейд","Н. Золотухин","Не требуется","Новый Дубляж","Нурмухаметов","Первый канал","Р. Янкелевич","С. Кузьмичёв","С. Щегольков","Сергей Дидок","Синема Трейд","Синта Рурони","Студия Райдо","Тоникс Медиа","Точка Zрения","Фильмэкспорт","Элегия фильм","1001 cinema","BTI Studios","Cactus Team","CrezaStudio","Crunchyroll","DVD Classic","Description","Eurochannel","FocusStudio","Franek Monk","Gala Voices","Gears Media","GladiolusTV","Gold Cinema","Good People","HiWay Grope","Inter Video","JWA Project","Lazer Video","Max Nabokov","NEON Studio","Neoclassica","New Records","Nickelodeon","Nika Lenina","Oghra-Brown","Paul Bunyan","Rebel Voice","RecentFilms","RiZZ_fisher","Saint Sound","SakuraNight","SnowRecords","Sony Sci-Fi","Sound-Group","StudioFilms","TF-AniGroup","TrainStudio","XDUB Dorama","Zone Studio","Zone Vision","hungry_inri","Варус Видео","Варус-Видео","Видеосервис","Володарский","Г. Либергал","Г. Румянцев","Другое кино","Е. Гаевский","Завгородний","И. Сафронов","И. Степанов","Кенс Матвей","КураСгречей","Лазер Видео","Малиновский","Мастер Тэйп","Неоклассика","Новый Канал","Огородников","Петербуржец","Прямостанов","С. Визгунов","С. Кузнецов","Севастьянов","Студия Трёх","Цікава Ідея","Эй Би Видео","Я. Беллманн","1001cinema","1WinStudio","AXN Sci-Fi","AimaksaLTV","Animegroup","ApofysTeam","AvePremier","BraveSound","CP Digital","CactusTeam","CinemaTone","Contentica","CoralMedia","DniproFilm","ELEKTRI4KA","East Dream","Fox Russia","HiWayGrope","LevshaFilm","MaxMeister","Mega-Anime","MifSnaiper","NewStation","Nice-Media","Pazl Voice","PiratVoice","Postmodern","Rain Death","Reanimedia","Shachiburi","SilverSnow","Sky Voices","SkyeFilmTV","Sony Turbo","Sound Film","StudioBand","TatamiFilm","VGM Studio","VSI Moscow","VoicePower","West Video","W³: voices","eraserhead","Б. Федоров","Бусов Глеб","Ващенко С.","Глуховский","Держиморда","Е. Гранкин","И. Еремеев","Интерфильм","Инфо-фильм","К. Филонов","Карповский","Комедия ТВ","Костюкевич","Мост Видео","Мост-Видео","Н. Антонов","Н. Дроздов","Новый диск","Ох! Студия","Первый ТВЧ","Переводман","С. Казаков","С. Лебедев","С. Макашов","Саня Белый","Союз Видео","Студия NLS","Т.О Друзей","ТВ XXI век","Толстобров","Хуан Рохас","Электричка","Ю. Немахов","диктор CDV","3df voice","AAA-Sound","Andre1288","AniLibria","AniPLague","Astana TV","AveBrasil","AveDorama","BeniAffet","CBS Drama","CLS Media","CasStudio","Discovery","DoubleRec","Epic Team","FanStudio","FilmsClub","Flux-Team","Fox Crime","GREEN TEA","Ghostface","GoodVideo","Gramalant","HighHopes","INTERFILM","JoyStudio","KinoGolos","Kinomania","Kobayashi","LakeFilms","Neo-Sound","NewComers","NewStudio","No-Future","Novamedia","OnisFilms","Persona99","RATTLEBOX","RainDeath","Red Media","SDI Media","SOLDLUCK2","Sawyer888","Sedorelli","Seoul Bay","Sephiroth","ShinkaDan","SmallFilm","SpaceDust","Timecraft","Total DVD","VIZ Media","Video-BIZ","Videogram","fiendover","turok1990","ААА-sound","Амальгама","АрхиТеатр","Васильцев","Весельчак","Видеобаза","Воротилин","Григорьев","Деньщиков","ЕА Синема","Зереницын","Золотухин","И. Клушин","Имидж-Арт","Карапетян","Киномания","Кириллица","Машинский","Мительман","Муравский","Невафильм","Останкино","Причудики","Рыжий пес","С. Дьяков","СВ Студия","СВ-Студия","Самарский","Синема УС","Советский","Солодухин","ТО Друзей","Формат AB","Хрусталев","Шадинский","Ю. Сербин","Ю. Товбин","Янкелевич","AB-Video","ALEKS KV","ANIvoice","AdiSound","AlexFilm","Amalgama","AniMaunt","AniMedia","Animedub","AuraFilm","AzOnFilm","Barin101","ClubFATE","ColdFilm","DeadLine","DexterTV","Extrabit","FilmGate","Fox Life","Foxlight","GetSmart","GoldTeam","GostFilm","Gravi-TV","Hallmark","IdeaFilm","ImageArt","JeFerSon","Jimmy J.","Kerems13","KinoView","Loginoff","LostFilm","MOYGOLOS","Marclail","Milirina","MiraiDub","Murzilka","NovaFilm","OMSKBIRD","Omskbird","Radamant","RealFake","RoxMarty","STEPonee","SorzTeam","Superbit","TurkStar","Ultradox","VashMax2","VendettA","VideoBIZ","WestFilm","XL Media","kubik&ko","metalrus","st.Elrom","Алексеев","Артемьев","АрхиАзия","Бахурани","Бессонов","Васильев","Визгунов","Войсовер","Воронцов","Гаврилов","Гаевский","Горчаков","Дольский","Домашний","Дубровин","Дьяконов","Е. Лурье","Е. Рудой","Журавлев","Заугаров","Индия ТВ","Ист-Вест","Карусель","Кинолюкс","Кузнецов","ЛанселаП","Лексикон","Ленфильм","Либергал","Логинофф","Марченко","Махонько","Медведев","Мельница","Мосфильм","Нарышкин","Оверлорд","Оригинал","Пирамида","С. Рябов","СВ-Дубль","Савченко","Субтитры","Супербит","Тимофеев","Толмачев","Хлопушка","Ю. Живов","5 канал","Amalgam","AniFilm","AniStar","AniWayt","Anifilm","Anistar","AnyFilm","AveTurk","BadBajo","BaibaKo","BukeDub","DeadSno","ELYSIUM","Eladiel","Elysium","F-TRAIN","FireDub","FoxLife","HDrezka","Hamster","Janetta","Jaskier","Kолобок","LeDoyen","Levelin","Liga HQ","Lord32x","MUZOBOZ","Macross","McElroy","MixFilm","NemFilm","Netflix","Octopus","Onibaku","OpenDub","Paradox","PashaUp","RUSCICO","RusFilm","SOFTBOX","Sam2007","SesDizi","ShowJet","SoftBox","SomeWax","TV 1000","TVShows","To4kaTV","Trina_D","Twister","Urasiko","VicTeam","Wakanim","ZM-SHOW","ZM-Show","datynet","lord666","sf@irat","Абдулов","Багичев","Бибиков","Ващенко","Герусов","Данилов","Дасевич","Дохалов","Кипарис","Клюквин","Колобок","Королев","Королёв","Латышев","Люсьена","Матвеев","Михалев","Морозов","Назаров","Немахов","Никитин","Омикрон","Ошурков","Парадиз","Пепелац","Пифагор","Позитив","Пятница","РуФилмс","Рутилов","СВ-Кадр","Синхрон","Смирнов","Сокуров","Сонотек","Сонькин","Сыендук","Филонов","Хихидок","Яковлев","Яроцкий","заКАДРЫ","100 ТВ","4u2ges","Alezan","Amedia","Ancord","AniDUB","Anubis","Azazel","BD CEE","Berial","Boльгa","Cuba77","D.I.M.","DubLik","Dubляж","Elegia","Emslie","FocusX","GalVid","Gemini","Jetvis","JimmyJ","KANSAI","KOleso","Kansai","Kiitos","L0cDoG","LeXiKC","Lisitz","Mikail","Milvus","MrRose","Nastia","NewDub","OSLIKt","Ozz TV","Ozz.tv","Prolix","RedDog","Rumble","SNK-TV","Satkur","Selena","Shaman","Stevie","Suzaku","TV1000","Tycoon","UAFlix","WVoice","WiaDUB","ZEE TV","Zendos","Zerzia","binjak","den904","kiitos","madrid","neko64","АБыГДе","Агапов","Акалит","Акопян","Акцент","Альянс","Анубис","Арк-ТВ","Бойков","Векшин","Вихров","Вольга","Гоблин","Готлиб","Гризли","Гундос","Гуртом","ДиоНиК","Дьяков","Есарев","Живаго","Жучков","Зебуро","Иванов","Карцев","Кашкин","Килька","Киреев","Козлов","Кондор","Котова","Кошкин","Кравец","Курдов","Лагута","Лапшин","Лизард","Миняев","Мудров","Н-Кино","НЕВА 1","НЛО-TV","Набиев","Нева-1","Пронин","Пучков","Ракурс","Россия","С.Р.И.","Санаев","Светла","Сербин","Стасюк","Строев","ТВ СПб","Товбин","Шварко","Швецов","Шуваев","Amber","AniUA","Anika","Arisu","Cmert","D2Lab","D2lab","DeMon","Elrom","IНТЕР","JetiX","Jetix","Kerob","Lupin","Ozeon","PaDet","RinGo","Ryc99","SHIZA","Solod","To4ka","erogg","ko136","seqw0","ssvss","zamez","Акира","АнВад","Белов","Бигыч","ВГТРК","Велес","Ворон","Гланц","Живов","Игмар","Интер","Котов","Лайко","Мишин","Новий","Перец","Попов","Райдо","РенТВ","Рудой","Рукин","Рыбин","Рябов","С.Р.И","ТВЧ 1","Хабар","Чадов","Штамп","Штейн","Andy","CPIG","Dice","ETV+","Gits","ICTV","Jade","KIHO","Laci","RAIM","SGEV","Tori","Troy","Twix","Vano","Voiz","jept","ИДДК","Инис","Ирэн","Нота","ТВ-3","ТВИН","Твин","Чуев","1+1","2+2","2x2","2х2","AMC","AMS","AOS","CDV","DDV","FDV","FOX","ICG","IVI","JAM","LDV","MCA","MGM","MTV","Oni","QTV","TB5","V1R","VHS","АМС","ГКГ","ДТВ","ИГМ","КТК","МИР","НСТ","НТВ","НТН","РТР","СТС","ТВ3","ТВ6","ТВЦ","ТНТ","ТРК","Че!","D1","R5","К9","Закадровый","Многоголосый"];s.sort((function(e,a){return a.length-e.length})),Lampa.Lang.add({skazfix_wait:{ru:"Секундочку...",en:"Wait a moment...",uk:"Секундочку...",zh:"稍等..."},skazfix_error_title:{ru:"Вот досада...",en:"What a pity...",uk:"От прикрість...",zh:"真遗憾..."},skazfix_no_files:{ru:"Нет доступных файлов для воспроизведения с выбранным переводом",en:"No files available for playback with selected translation",uk:"Немає доступних файлів для відтворення з обраним перекладом",zh:"所选翻译没有可播放的文件"},skazfix_want_other:{ru:"Хотите выбрать другой?",en:"Do you want to choose another?",uk:"Хочете обрати інший?",zh:"您想选择另一个吗？"},skazfix_choose_other:{ru:"Выбрать другой",en:"Choose another",uk:"Обрати інший",zh:"选择另一个"},skazfix_choose_translation:{ru:"Выберите перевод",en:"Choose translation",uk:"Оберіть переклад",zh:"选择翻译"},skazfix_choose_stream:{ru:"Выберите поток",en:"Choose stream",uk:"Оберіть потік",zh:"选择流"},skazfix_stream:{ru:"Поток",en:"Stream",uk:"Потік",zh:"流"},skazfix_default:{ru:"Неизвестный перевод",en:"Unknown translation",uk:"Невідомий переклад",zh:"未知翻译"},skazfix_no_content:{ru:"К сожалению, не удалось найти видеоконтент для этого фильма. Попробуйте выбрать другой фильм или повторите попытку позже.",en:"Unfortunately, we couldn't find video content for this movie. Try selecting another movie or try again later.",uk:"На жаль, не вдалося знайти відеоконтент для цього фільму. Спробуйте обрати інший фільм або повторіть спробу пізніше.",zh:"很抱歉，我们找不到这部电影的视频内容。请尝试选择其他电影或稍后再试。"},skazfix_no_links:{ru:"Не удалось найти ссылок, выберите другой перевод",en:"Could not find links, choose another translation",uk:"Не вдалося знайти посилань, оберіть інший переклад",zh:"找不到链接，请选择其他翻译"},skazfix_online_title:{ru:"OnlySkaz 2.0",en:"OnlySkaz 2.0",uk:"OnlySkaz 2.0",zh:"OnlySkaz 2.0"},skazfix_always_show_choices:{ru:"Всегда выбирать озвучку и качество",en:"Always select voice and quality",uk:"Завжди вибирати озвучення і якість",zh:"总是选择配音和质量"},skazfix_always_show_choices_desc:{ru:"Всегда показывать выбор озвучки и потока",en:"Always show voice and stream selection",uk:"Завжди показувати вибір озвучення та потоку",zh:"始终显示配音和流选择"},skazfix_work_mode:{ru:"Режим работы",en:"Work mode",uk:"Режим роботи",zh:"工作模式"},skazfix_yes:{ru:"Да",en:"Yes",uk:"Так",zh:"是"},skazfix_no:{ru:"Нет",en:"No",uk:"Ні",zh:"否"},skazfix_online:{ru:"OnlySkaz 2.0",en:"OnlySkaz 2.0",uk:"OnlySkaz 2.0",zh:"OnlySkaz 2.0"},skazfix_close:{ru:"Закрыть",en:"Close",uk:"Закрити",zh:"关闭"},skazfix_action:{ru:"Действие",en:"Action",uk:"Дія",zh:"操作"},skazfix_mark:{ru:"Пометить",en:"Mark",uk:"Позначити",zh:"标记"},skazfix_unmark:{ru:"Снять отметку",en:"Unmark",uk:"Зняти позначку",zh:"取消标记"},skazfix_timeclear:{ru:"Сбросить тайм-код",en:"Reset timecode",uk:"Скинути тайм-код",zh:"重置时间码"},skazfix_clearallmark:{ru:"Очистить все метки",en:"Clear all marks",uk:"Очистити всі позначки",zh:"清除所有标记"},skazfix_clearalltime:{ru:"Очистить все тайм-коды",en:"Clear all timecodes",uk:"Очистити всі тайм-коди",zh:"清除所有时间码"},skazfix_more:{ru:"Ещё",en:"More",uk:"Ще",zh:"更多"},skazfix_sources_title:{ru:"Источники",en:"Sources",uk:"Джерела",zh:"源"},skazfix_choose_sources:{ru:"Выбор источников",en:"Choose sources",uk:"Вибір джерел",zh:"选择源"},skazfix_choose_balancers:{ru:"Выбрать балансеры для поиска",en:"Choose balancers for search",uk:"Обрати балансери для пошуку",zh:"选择搜索平衡器"},skazfix_reset_default:{ru:"Сбросить по умолчанию",en:"Reset to default",uk:"Скинути за замовчуванням",zh:"重置为默认"},skazfix_sources_reset:{ru:"Источники сброшены",en:"Sources reset",uk:"Джерела скинуто",zh:"源已重置"},skazfix_anime_title:{ru:"Аниме",en:"Anime",uk:"Аніме",zh:"动漫"},skazfix_remember_choices:{ru:"Запоминать озвучку, качество и балансер",en:"Remember voice, quality and balancer",uk:"Запам'ятовувати озвучення, якість і балансер",zh:"记住配音、质量和平衡器"},skazfix_remember_choices_desc:{ru:"Автоматически применять последний выбор при переключении серий",en:"Automatically apply last choice when switching episodes",uk:"Автоматично застосовувати останній вибір при перемиканні серій",zh:"切换剧集时自动应用上次选择"},skazfix_reset_remembered:{ru:"Сбросить сохранённую озвучку и качество",en:"Reset saved voice and quality",uk:"Скинути збережену озвучку та якість",zh:"重置保存的配音和质量"},skazfix_remembered_reset_done:{ru:"Сохранённая озвучка и качество сброшены",en:"Saved voice and quality have been reset",uk:"Збережену озвучку та якість скинуто",zh:"保存的配音和质量已重置"},skazfix_reset_section:{ru:"Сброс данных",en:"Reset data",uk:"Скидання даних",zh:"重置数据"},skazfix_clear_cache:{ru:"Очистить кеш серий",en:"Clear episodes cache",uk:"Очистити кеш серій",zh:"清除剧集缓存"},skazfix_cache_cleared:{ru:"Кеш серий очищен",en:"Episodes cache cleared",uk:"Кеш серій очищено",zh:"剧集缓存已清除"}});var c="http://",u="online_server_tokens",m="online_always_show_choices",f="online_selected_sources",d="online_selected_anime_sources",p="online_remember_choices",h="online_remembered_data",v=null,y='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" paint-order="stroke" stroke-opacity="100%" stroke="#fff" stroke-width="2" fill="currentColor"><path d="M 25 2 C 12.309288 2 2 12.309297 2 25 C 2 37.690703 12.309288 48 25 48 C 37.690712 48 48 37.690703 48 25 C 48 12.309297 37.690712 2 25 2 z M 25 4 C 36.609833 4 46 13.390175 46 25 C 46 36.609825 36.609833 46 25 46 C 13.390167 46 4 36.609825 4 25 C 4 13.390175 13.390167 4 25 4 z M 25 6.5 C 14.799 6.5 6.5 14.799 6.5 25 C 6.5 35.201 14.799 43.5 25 43.5 C 35.201 43.5 43.5 35.201 43.5 25 C 43.5 14.799 35.201 6.5 25 6.5 z M 24.757812 11.998047 C 30.071813 11.998047 33.514203 14.994953 34.283203 20.251953 L 30.080078 20.789062 C 30.080078 17.378062 28.162859 15.841797 24.755859 15.841797 C 21.970859 15.841797 18.994141 16.444969 18.994141 19.042969 C 18.994141 20.937969 20.6335 21.807875 26.3125 22.921875 C 30.3585 23.715875 35 25.297406 35 30.566406 C 35 34.158406 31.087719 38 25.261719 38 C 19.230719 38 15.569625 34.913828 14.640625 29.048828 L 18.892578 28.302734 C 18.892578 32.399734 21.118719 34.158203 25.261719 34.158203 C 28.808719 34.158203 31.174203 32.557406 31.158203 30.566406 C 31.143203 28.657406 30.003172 27.637547 25.576172 26.685547 C 20.946172 25.689547 15.152344 24.644969 15.152344 19.042969 C 15.152344 14.471969 20.102813 11.998047 24.757812 11.998047 z"></path></svg>',g=[{id:"rezka",name:"rezka",enabled:!1,clarification:1},{id:"rc/rhs",name:"rc/rhs",enabled:!1,clarification:1},{id:"rhsprem",name:"HDRezka",enabled:!0,clarification:1},{id:"kinopub",name:"kinopub",enabled:!0,clarification:1},{id:"vokino",name:"vokino",enabled:!1,clarification:1},{id:"mirage",name:"mirage",enabled:!1,clarification:1},{id:"alloha",name:"alloha",enabled:!0,clarification:1},{id:"rc/filmix",name:"rc/filmix",enabled:!1,clarification:1},{id:"rc/fxapi",name:"rc/fxapi",enabled:!1,clarification:1},{id:"fxapi",name:"fxapi",enabled:!1,clarification:1},{id:"filmix",name:"filmix",enabled:!0,clarification:1},{id:"filmixtv",name:"filmixtv",enabled:!1,clarification:1},{id:["videocdn","lumex"],name:"lumex",enabled:!1,clarification:1},{id:"kinogo",name:"kinogo",enabled:!1,clarification:1},{id:"vkmovie",name:"VK",enabled:!1,clarification:1},{id:"rutubemovie",name:"rutube",enabled:!1,clarification:1},{id:"videodb",name:"videodb",enabled:!1,clarification:1},{id:"collaps",name:"collaps",enabled:!1,clarification:1},{id:"collaps-dash",name:"collaps-dash",enabled:!1,clarification:1},{id:"hdvb",name:"hdvb",enabled:!1,clarification:1},{id:"zetflix",name:"zetflix",enabled:!1,clarification:1},{id:"veoveo",name:"veoveo",enabled:!1,clarification:1},{id:"kodik",name:"kodik",enabled:!0,clarification:0,anime:!0},{id:"ashdi",name:"ashdi",enabled:!1,clarification:1},{id:"kinoukr",name:"kinoukr",enabled:!1,clarification:1},{id:"kinotochka",name:"kinotochka",enabled:!1,clarification:1},{id:"remux",name:"remux",enabled:!1,clarification:1},{id:"iframevideo",name:"iframevideo",enabled:!1,clarification:1},{id:"cdnmovies",name:"cdnmovies",enabled:!1,clarification:1},{id:"anilibria",name:"anilibria",enabled:!1,clarification:1},{id:"animedia",name:"animedia",enabled:!1,clarification:1},{id:"animego",name:"animego",enabled:!1,clarification:1},{id:"animevost",name:"animevost",enabled:!1,clarification:1},{id:"animebesst",name:"animebesst",enabled:!1,clarification:1},{id:"redheadsound",name:"redheadsound",enabled:!1,clarification:1},{id:"animelib",name:"animelib",enabled:!1,clarification:1},{id:"moonanime",name:"moonanime",enabled:!1,clarification:1},{id:"vibix",name:"vibix",enabled:!1,clarification:1},{id:"vdbmovies",name:"vdbmovies",enabled:!1,clarification:1},{id:"fancdn",name:"fancdn",enabled:!1,clarification:1},{id:"cdnvideohub",name:"cdnvideohub",enabled:!1,clarification:1},{id:"vcdn",name:"vcdn",enabled:!1,clarification:1},{id:"hydraflix",name:"hydraflix",enabled:!1,clarification:1},{id:"videasy",name:"videasy",enabled:!1,clarification:1},{id:"vidsrc",name:"vidsrc",enabled:!1,clarification:1},{id:"movpi",name:"movpi",enabled:!1,clarification:1},{id:"vidlink",name:"vidlink",enabled:!1,clarification:1},{id:"twoembed",name:"twoembed",enabled:!1,clarification:1},{id:"autoembed",name:"autoembed",enabled:!1,clarification:1},{id:"smashystream",name:"smashystream",enabled:!1,clarification:1},{id:"rgshows",name:"rgshows",enabled:!1,clarification:1},{id:"pidtor",name:"pidtor",enabled:!1,clarification:1},{id:"videoseed",name:"videoseed",enabled:!1,clarification:1},{id:"iptvonline",name:"iptvonline",enabled:!1,clarification:1},{id:"eneyida",name:"eneyida",enabled:!1,clarification:1},{id:"kinobase",name:"kinobase",enabled:!1,clarification:1}];function _(){return g.filter((function(e){return e.enabled&&!e.anime})).map((function(e){return Lampa.Arrays.isArray(e.id)?e.id[0]:e.id}))}function k(){return g.filter((function(e){return e.enabled&&e.anime})).map((function(e){return Lampa.Arrays.isArray(e.id)?e.id[0]:e.id}))}function L(){var e=Lampa.Storage.get(f,[]);if("string"==typeof e)try{e=JSON.parse(e)}catch(a){e=[]}Lampa.Arrays.isArray(e)&&0!==e.length||(e=_());var a=_();return 0===(e=e.filter((function(e){return-1!==a.indexOf(e)}))).length&&(e=_()),e}function b(e){Lampa.Storage.set(f,e)}function x(){var e=Lampa.Storage.get(d,[]);if("string"==typeof e)try{e=JSON.parse(e)}catch(a){e=[]}Lampa.Arrays.isArray(e)&&0!==e.length||(e=k());var a=k();return 0===(e=e.filter((function(e){return-1!==a.indexOf(e)}))).length&&(e=k()),e}function S(e){Lampa.Storage.set(d,e)}function w(){var e=Lampa.Storage.get("skazonline_servers");return!0===e||"true"===e?["http://onlinecf3.skaz.tv/","http://onlinecf4.skaz.tv/","http://onlinecf5.skaz.tv/"]:["http://online3.skaz.tv/","http://online4.skaz.tv/","http://online5.skaz.tv/"]}var C=[],z="";function O(e){var a=w().filter((function(a){var t=a.replace(/\/+$/,"");return-1===e.indexOf(t)}));return 0===a.length?null:a[Math.floor(Math.random()*a.length)]}function A(){if(z)return z;var e=O(C);if(e||(C=[],e=O([])),!e)return"";var a=e.replace(/\/+$/,"");return 0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&(a="http://"+a),z=a,a}function T(e){if(e){var a=e.replace(/\/+$/,"");-1===C.indexOf(a)&&C.push(a),z=""}}function P(){C=[],z=""}function q(){var e=w();return C.length<e.length}function E(){return Lampa.Storage.get(m,!1)}function F(e){Lampa.Storage.set(m,e)}function j(){return Lampa.Storage.get(p,!1)}function D(e){Lampa.Storage.set(p,e)}function V(){if(!v)return{};var e=Lampa.Storage.get(h,"{}");if("string"==typeof e)try{e=JSON.parse(e)}catch(a){e={}}return(e=e||{})[v]||{}}function R(e){if(v){var a=Lampa.Storage.get(h,"{}");if("string"==typeof a)try{a=JSON.parse(a)}catch(e){a={}}(a=a||{})[v]=e,Lampa.Storage.set(h,a)}}function M(){return V().quality||""}function B(){return V().flowUrl||""}function N(){return V().sourceName||""}function I(){Lampa.Storage.set(h,"{}")}function U(e){return function(){var e=Lampa.Storage.get(u,"{}");if("string"==typeof e)try{e=JSON.parse(e)}catch(a){e={}}return e||{}}()[e]||""}var G={get stream(){var e=A();return e?e.replace(/^https?:\/\//,""):""},get sources(){return L()},get anime(){return x()},nolite:[],filter_ts:["ts","тс","tс","тc","чистый звук"],filter_hr:["HDR10","HEVC"],filter_db:["Дубляж","Дублированный","Red Head Sound","Мосфильм","Dubляж"],filter_tv:[],filter_uk:["uk","ukr","укр"],filter_du:["Дубляж","Дублированный","Полное дублирование"],rename_translate:{HDRezka:["HDrezka Studio","RezkaStudio","Rezka Studio","Rezka"],StudioBand:["Студийная Банда","StudioBand","Studio Band"],"Дубляж":["Дубляж","Дублированный","Полное дублирование"],"Оригинал":["Не требуется","Оригинальный"],"Закадровый":["Многоголосый","Закадровый"]},filter_translate:s};function J(e,a){if(!e||!a)return!1;var t=e.toLowerCase().replace(/ /g,"").split(/\.|\[/)[0],n=a.toLowerCase().replace(/ /g,"").split(/\.|\[/)[0];return!(!t||!n)&&((t.length<=n.length?t:n).length<4?t===n:t.indexOf(n)>-1||n.indexOf(t)>-1)}function H(){var e=Lampa.Storage.get("region","{}");return e.code?e.code:"ru"}function K(e){return e.translate||e.name||e.details||e.title||""}function Q(e){return e.forEach((function(e){["translate","title","details","name"].forEach((function(a){if(e[a]){if(0===e[a].indexOf(Lampa.Lang.translate("skazfix_default")))return;if(/^\d{3,4}p$/i.test(e[a]))return void(e[a]=Lampa.Lang.translate("skazfix_default"));var t=e[a],n=!1,i=t.replace(/\s*\([^)]*\)\s*$/,"").trim();if(G.filter_translate.forEach((function(t){i.toLowerCase().indexOf(t.toLowerCase())>=0&&(e[a]=t,n=!0)})),!n){var r=function(t){G.rename_translate[t].forEach((function(r){i.toLowerCase()==r.toLowerCase()&&(e[a]=t,n=!0)}))};for(var o in G.rename_translate)r(o)}if(n||G.filter_du.forEach((function(t){i.toLowerCase().indexOf(t.toLowerCase())>=0&&(e[a]=t,n=!0)})),!n){var l=(s=/\(([^()]+)\)$/,c=1,(m=(u=t).match(s))&&m[c]?m[c]:u);l!==t&&G.filter_translate.forEach((function(t){l.toLowerCase().indexOf(t.toLowerCase())>=0&&(e[a]=t,n=!0)}))}n||(i.length>0?e[a]=i:e[a]=Lampa.Lang.translate("skazfix_default"))}var s,c,u,m}))})),e}var W={compareVoice:J,region:H,voice:K,player:function(){return Lampa.Platform.is("tizen")||Lampa.Platform.is("webos")?"inner":Lampa.Storage.field("player")},filterTranslate:function(e){if(!e||!Lampa.Arrays.isArray(e)||0===e.length)return[];var a=e.filter((function(e){return 0==G.filter_hr.filter((function(a){return K(e).toLowerCase().indexOf(a.toLowerCase())>=0})).length}));return a=a.filter((function(e){return 0==G.filter_ts.filter((function(a){return K(e).toLowerCase().indexOf(" "+a.toLowerCase())>=0})).length})),"ru"==H()&&(a=a.filter((function(e){return 0==G.filter_uk.filter((function(a){return K(e).toLowerCase().indexOf(a.toLowerCase())>=0})).length}))),Q(a),a},renameTranslate:Q,sortDUBTranstale:function(e){e.sort((function(e,a){var t=G.filter_db.filter((function(a){return K(e).toLowerCase().indexOf(a.toLowerCase())>=0})).length,n=G.filter_db.filter((function(e){return K(a).toLowerCase().indexOf(e.toLowerCase())>=0})).length;return t&&!n?-1:!t&&n?1:0}))},modalChoiceTranstale:function(e,a){var t=Lampa.Controller.enabled().name,n=$('<div class="connect-broken">\n\t\t\t\t\t\t<div class="connect-broken__title">'.concat(Lampa.Lang.translate("skazfix_error_title"),'</div>\n\t\t\t\t\t\t<div class="connect-broken__text">').concat(Lampa.Lang.translate("skazfix_no_files")," (<b>").concat(e.from,"</b>). ").concat(Lampa.Lang.translate("skazfix_want_other"),'</div>\n\t\t\t\t\t\t<div class="connect-broken__footer">\n\t\t\t\t\t\t\t<div class="selector simple-button next">').concat(Lampa.Lang.translate("skazfix_choose_other"),"</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"));n.find(".selector").on("hover:enter",(function(){Lampa.Modal.close(),Lampa.Controller.toggle(t)})),n.find(".next").on("hover:enter",(function(){Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_translation"),items:e.voicelist,onBack:function(){Lampa.Controller.toggle(t),a&&a()}})})),Lampa.Modal.open({title:"",html:n,onBack:function(){Lampa.Modal.close(),Lampa.Controller.toggle(t),a&&a()}})},selectChoiceTranstale:function(e,a,t){var n={};if(e.forEach((function(e){var a=K(e).replace(/\.Subtitles$/i,"");n[a]||(n[a]={items:[],sources:[],maxquality:0}),n[a].items.push(e);var t=e.source_name||"";t&&-1===n[a].sources.indexOf(t)&&n[a].sources.push(t);var i=parseInt(e.maxquality)||0;i>n[a].maxquality&&(n[a].maxquality=i)})),j()){var i=V().voice||"";M(),N(),B();if(i)for(var r in n)if(J(r,i)){var o=n[r].items[0];return void t(o)}}var l=[];for(var s in n){var c=n[s],u=[];c.sources.length>0&&u.push(c.sources.join(", ")),c.maxquality>0&&u.push(c.maxquality+"p"),l.push({title:s,subtitle:u.join(" • "),selected:J(s,a),voiceItems:c.items,onSelect:function(){var e,a;j()&&(e=this.title,(a=V()).voice=e,R(a)),Lampa.Controller.toggle("content"),t(this.voiceItems[0])}})}Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_translation"),items:l,onBack:function(){Lampa.Controller.toggle("content")}})},selectChoiceFlow:function(e,a){if(j()){var t=M(),n=N(),i=B();if(t||n||i){var r=null;if(i&&(r=e.find((function(e){return e.url===i}))),!r&&n&&t&&(r=e.find((function(e){return e.quality==t&&e.source_name===n}))),!r&&t&&(r=e.find((function(e){return e.quality==t}))),r)return void a(r)}}Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_stream"),items:e.map((function(e){return{title:e.quality+(e.label?"<sub>"+e.label+"</sub>":""),selected:e.selected,subtitle:e.source_name?e.source_name+" | "+Lampa.Utils.shortText(e.url,35):Lampa.Utils.shortText(e.url,35),onSelect:function(){var t,n,i,r;j()&&(t=e.quality,n=e.url,i=e.source_name,(r=V()).quality=t,r.flowUrl=n,r.sourceName=i||"",R(r)),Lampa.Controller.toggle("content"),a(e)}}})),onBack:function(){Lampa.Controller.toggle("content")}})}};function X(e){if(-1==(e+="").indexOf("uid=")){var a=Lampa.Storage.get("lampac_unic_id","")||"guest";e=Lampa.Utils.addUrlComponent(e,"uid="+encodeURIComponent(a))}if(-1==e.indexOf("account_email=")){var t=Lampa.Storage.get("account_email","");t&&(e=Lampa.Utils.addUrlComponent(e,"account_email="+encodeURIComponent(t)))}-1==e.indexOf("rchtype=")&&(e=Lampa.Utils.addUrlComponent(e,"rchtype=web"));var n=function(){var e=A();if(!e)return"";var a=e.replace(/^https?:\/\//,"").replace(/\/+$/,"");return U(e)||U(e.replace(/\/+$/,""))||U(a)||""}();if(n){var i=n.split("=")[0];i&&-1==e.indexOf(i+"=")&&(e=Lampa.Utils.addUrlComponent(e,n))}return e}var Z={},Y=function(){function t(e){a(this,t),this.object=e,this.network=new Lampa.Reguest,this.voiceSave=new r(e),this.memkey=null,this.lifeChecked=!1,this._voiceCache={}}return n(t,[{key:"externalids",value:function(){var e=this;return new Promise((function(a,t){if(e.object.movie.imdb_id&&e.object.movie.kinopoisk_id)a();else{var n=[];n.push("id="+e.object.movie.id),n.push("serial="+(e.object.movie.name?1:0)),e.object.movie.imdb_id&&n.push("imdb_id="+(e.object.movie.imdb_id||"")),e.object.movie.kinopoisk_id&&n.push("kinopoisk_id="+(e.object.movie.kinopoisk_id||""));var i=c+G.stream+"/externalids?"+n.join("&");e.network.timeout(1e4),e.network.silent(X(i),(function(t){for(var n in t)e.object.movie[n]=t[n];a()}),(function(){a()}))}}))}},{key:"requestParams",value:function(e){var a=[],t=this.object,n=t.movie.source||"tmdb";return a.push("id="+t.movie.id),t.movie.imdb_id&&a.push("imdb_id="+(t.movie.imdb_id||"")),t.movie.kinopoisk_id&&a.push("kinopoisk_id="+(t.movie.kinopoisk_id||"")),a.push("title="+encodeURIComponent(t.clarification?t.search:t.movie.title||t.movie.name)),a.push("original_title="+encodeURIComponent(t.movie.original_title||t.movie.original_name)),a.push("serial="+(t.movie.name?1:0)),a.push("original_language="+(t.movie.original_language||"")),a.push("year="+((t.movie.release_date||t.movie.first_air_date||"0000")+"").slice(0,4)),a.push("source="+n),a.push("clarification="+(t.clarification?1:0)),Lampa.Storage.get("account_email","")&&a.push("cub_id="+Lampa.Utils.hash(Lampa.Storage.get("account_email",""))),e+(e.indexOf("?")>=0?"&":"?")+a.join("&")}},{key:"query",value:function(e){var a=this;return new Promise((function(t,n){var i=[].concat(G.sources);e.movie&&e.movie.original_language&&["ja","ko","zh","cn"].find((function(a){return e.movie.original_language.toLowerCase()==a}))&&(i=i.concat(G.anime));var r,l=new o(i.length),s=!1;function c(){s||Lampa.Noty.show(Lampa.Lang.translate("skazfix_wait"))}c(),r=setInterval(c,2e3),l.onComplite=function(e){s=!0,clearInterval(r);var a=[],o=700;i.forEach((function(t){var n=e[t];if(n)if(n.error)o=n.error;else if(n.accsdb)o=600;else if("similar"!=n.type&&n.data&&0!==n.data.length){var i=n.balanser||n._source_id||t;n.voice&&Lampa.Arrays.isArray(n.voice)&&n.voice.forEach((function(e){e.source_name=i})),n.data&&Lampa.Arrays.isArray(n.data)&&n.data.forEach((function(e){e.source_name=i})),n.source_name=i,a.push(n.voice?n:n.data)}})),a.length?t(a):n(o)},i.forEach((function(t){a.source(t,e.season).then((function(e){if(e.voice&&e.data&&e.data[0]&&e.data[0].quality){var a=0;for(var n in e.data[0].quality){var i=parseInt(n);i>a&&(a=i)}a>0&&e.voice.forEach((function(e){(!e.maxquality||parseInt(e.maxquality)<a)&&(e.maxquality=a+"p")}))}e._source_id=t,l.append(t,e)})).catch((function(e){l.append(t,{error:e})}))}))}))}},{key:"checkLife",value:function(){var e=this;return new Promise((function(a,t){if(e.lifeChecked)a();else{var n=c+G.stream+"/lite/events?life=true",i=e.requestParams(X(n));-1!==(i=i.replace("rjson=true&","").replace("&rjson=true","").replace("rjson=true","")).indexOf("clarification=0")&&(i=i.replace("clarification=0","clarification=1")),-1===i.indexOf("similar=")&&(i=Lampa.Utils.addUrlComponent(i,"similar=false")),e.network.timeout(1e4),e.network.silent(i,(function(t){var n;try{n="string"==typeof t?JSON.parse(t):t}catch(e){}e.lifeChecked=!0,n&&n.life&&n.memkey&&(e.memkey=n.memkey),a()}),(function(){e.lifeChecked=!0,a()}),!1,{dataType:"text"})}}))}},{key:"parseJsonResponse",value:function(e){var a={voice:[],data:[]};return e&&e.data&&Lampa.Arrays.isArray(e.data)?(e.data.forEach((function(e){e.stream?(a.data.push({method:"play",url:e.stream,quality:{auto:e.stream},translate:e.translate||"",maxquality:e.maxquality||"",title:e.title||"",voice_name:e.translate||e.voice_name||""}),a.voice.push({name:e.translate||e.voice_name||"",maxquality:e.maxquality||"",method:"play",url:e.stream})):"play"===e.method&&e.url?(a.data.push({method:"play",url:e.url,quality:e.quality||{auto:e.url},translate:e.translate||"",maxquality:e.maxquality||"",title:e.title||"",voice_name:e.translate||e.voice_name||""}),a.voice.push({name:e.translate||e.voice_name||"",maxquality:e.maxquality||"",method:"play",url:e.url,quality:e.quality})):"call"===e.method&&e.url&&(a.data.push(e),a.voice.push({name:e.translate||e.voice_name||"",maxquality:e.maxquality||"",method:"call",url:e.url}))})),a.type=e.type,a):a}},{key:"source",value:function(e,a){var t=this;return new Promise((function(n,i){t.checkLife().then((function(){var r=function(e){for(var a=0;a<g.length;a++){var t=g[a],n=Lampa.Arrays.isArray(t.id)?t.id:[t.id];if(-1!==n.indexOf(e))return n}return[e]}(e),o=0,l=function(){if(o>=r.length)i(400);else{var e=r[o],s=function(r,u){var m=r?"/lite/":"/",f=c+G.stream+m+e,d=t.requestParams(X(f));d=Lampa.Utils.addUrlComponent(d,"rjson=true");var p=function(e){for(var a=0;a<g.length;a++){var t=g[a];if(-1!==(Lampa.Arrays.isArray(t.id)?t.id:[t.id]).indexOf(e))return void 0!==t.clarification?t.clarification:1}return 1}(e);1===p&&-1!==d.indexOf("clarification=0")?d=d.replace("clarification=0","clarification=1"):0===p&&-1!==d.indexOf("clarification=1")&&(d=d.replace("clarification=1","clarification=0")),-1===d.indexOf("similar=")&&(d=Lampa.Utils.addUrlComponent(d,"similar=false")),a&&(d+="&s="+a),t.network.timeout(1e4),t.network.silent(d,(function(e){var a;try{a="string"==typeof e?JSON.parse(e):e}catch(e){}a&&a.data&&!a.voice&&(a=t.parseJsonResponse(a)),a?"disable"===a||a.disable||a.error&&!a.data?(o++,l()):n(a):"disable"===e?(o++,l()):i(500)}),(function(){r?s(!1,u):(o++,l())}),!1,{})},u=-1==G.nolite.indexOf(e);s(u,!1)}};l()}))}))}},{key:"links",value:function(e){return new Promise((function(a,t){var n=[],i=[];e.forEach((function(e){n=n.concat(e.filter((function(e){return"call"==e.method}))),i=i.concat(e.filter((function(e){return"play"==e.method})))}));var r=new o(n.length);r.onComplite=function(){a(W.renameTranslate(i))};n.forEach((function(e){!function(e,a){var t=e.url;if(Z[t]){var n=Z[t],o=JSON.parse(JSON.stringify(n));return o.details=e.details||o.details||"no details",o.translate=e.translate||o.translate||"no translate",o.source_name=e.source_name,i.push(o),void r.next()}var l=new Lampa.Reguest,s=X(e.url);l.timeout(1e4),l.silent(s,(function(a){var n=a;if("string"==typeof n)try{n=JSON.parse(n)}catch(e){n={}}if(!n.quality&&n.url){n.quality={};var o=n.url;-1!==o.indexOf(" or ")&&(o=o.split(" or ")[0]),n.quality.auto=n.url}n.quality&&Object.keys(n.quality).length>0&&(Z[t]=JSON.parse(JSON.stringify(n)),n.details=e.details||n.details||"no details",n.translate=e.translate||n.translate||"no translate",n.source_name=e.source_name,i.push(n)),r.next()}),(function(e){r.error()}),!1,{dataType:"text"})}(e)})),0==n.length&&a(W.renameTranslate(i))}))}},{key:"m3u",value:function(e){var a=this;return new Promise((function(t,n){var i=[],r=Lampa.Storage.field("video_quality_default"),o=function(a){parseInt(a)<=r&&[e.quality[a].url].concat(e.quality[a].reserve).forEach((function(t){i.push({quality:a,name:e.name,url:t})}))};for(var l in e.quality)o(l);a.network.silent(c+G.stream+"/m3u/add",(function(e){t(c+G.stream+e.url)}),(function(e,a){n(400)}),{playlist:i})}))}},{key:"flows",value:function(e){var a=[],t=Lampa.Storage.field("video_quality_default"),n={},i=function(t){var i=[e[t].url].concat(e[t].reserve),r=parseInt(t),o=e[t].urlSources||{};i.forEach((function(e){n[e]||(n[e]=!0,a.push({int:r,label:r>1440?"4K":r>=1440?"2K":r>=1080?"FHD":r>=720?"HD":"",quality:t,url:e,source_name:o[e]||""}))}))};for(var r in e)i(r);var o=a.find((function(e){return e.int==t}));return o&&(o.selected=!0),a}},{key:"movie",value:function(e){var a=this;return new Promise((function(t,n){a.externalids().then((function(){return a.query(e)})).then((function(e){var i=[];e.forEach((function(e){var a=e.voice?e.voice:Lampa.Arrays.isArray(e)?e:[],t=W.filterTranslate(a);t.length&&(t.forEach((function(a){if(e.data&&Lampa.Arrays.isArray(e.data)){var t=e.data.find((function(e){return e.translate===a.name||e.voice_name===a.name||e.url===a.url}));t&&(a.quality=t.quality,a.url=t.url,a.method=t.method)}a.source_name=e.source_name||a.source_name})),i=i.concat(t))}));new Promise((function(e){var t=i.filter((function(e){return"call"==e.method}));if(0!=t.length){var n=new o(t.length),r=[];n.onComplite=function(){i=i.filter((function(e){return"call"!=e.method||-1!==r.indexOf(e)})),e()},t.forEach((function(e){var t;t=e.url,a.network.timeout(-1!==(e.source_name||"").toLowerCase().indexOf("mirage")?1e4:5e3),a.network.silent(X(t),(function(a){var t=a;t&&(t.url||t.quality&&Object.keys(t.quality).length>0)&&r.push(e),n.next()}),(function(){n.next()}))}))}else e()})).then((function(){if(i.forEach((function(e){e.maxquality=e.maxquality||"1080p",e.translate=e.translate||e.name||"";var a=e.translate.match(/\[(.*?)\]/);a&&(a=a[1].split(",").map((function(e){return e.trim()})),e.lang=(a.map((function(e){return e.toLowerCase()})).find((function(e){return"ru"==e||"uk"==e||"rus"==e||"ukr"==e||"укр"==e}))||"").toUpperCase(),e.lang="RUS"==e.lang?"RU":"UKR"==e.lang?"UA":e.lang,"RU"==e.lang&&"ru"==W.region()&&(e.lang=""),e.translate=a.find((function(e){return e.length>5}))||e.translate)})),0==i.length)throw new Error("No data");W.renameTranslate(i),t({sources:e,translates:i})})).catch((function(e){n(e)}))})).catch(n)}))}},{key:"tv",value:function(a){var t=this;return new Promise((function(n,r){t.externalids().then((function(){t.query(a).then((function(a){t.voice(a).then((function(t){n(function(a){for(var t=1;t<arguments.length;t++){var n,r=null!==(n=arguments[t])&&void 0!==n?n:{};t%2?e(Object(r),!0).forEach((function(e){i(a,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(r,e))}))}return a}({sources:a},t))})).catch(r)})).catch(r)}))}))}},{key:"voice",value:function(e){var a=this;return new Promise((function(t,n){var i=a.voiceSave.get();if(a._voiceCache[i])t(a._voiceCache[i]);else{var r=[],l=G.filter_tv,s=[],c=function(e,a){e.data.forEach((function(e){e.translate_name=a}))},u=function(e,a){return new Promise((function(a,t){var n=new Lampa.Reguest;n.timeout(1e4),n.silent(X(e.url),(function(i){var r,o=i;if("string"==typeof i)if(-1!==i.indexOf("<div")||-1!==i.indexOf("data-json"))r={data:[]},$(i).find("[data-json]").each((function(){try{var e=$(this).attr("data-json"),a=JSON.parse(e);"play"===a.method&&a.url&&r.data.push(a)}catch(e){}})),o=r;else try{o=JSON.parse(i)}catch(e){o={}}if(o.data&&0!==o.data.length){if(o.data.every((function(e){return"link"===e.method}))&&o.data.length>0){var l=o.data[0];return n.timeout(1e4),void n.silent(X(l.url),(function(i){var r=i;if("string"==typeof i)try{r=JSON.parse(i)}catch(e){r={}}if(r.data&&0!==r.data.length){if(c(r,W.voice(e)),r.data.every((function(e){return"call"===e.method}))&&r.data.length>0){if("kodik"===(e.source_name||"").toLowerCase())return void a(r.data);var o=r.data[0];return n.timeout(5e3),void n.silent(X(o.url),(function(e){var t=e;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){t={}}t.quality&&Object.keys(t.quality).length>0&&r.data.forEach((function(e){e.quality=t.quality,e.details=t.details||e.details,e.translate=t.translate||e.translate,e.method="play"})),a(r.data)}),(function(){a(r.data)}),!1,{dataType:"text"})}a(r.data)}else t("no episodes in season")}),(function(e){t("season link network error")}),!1,{dataType:"text"})}if(o.data.every((function(e){return"call"===e.method}))&&o.data.length>0)if("kodik"===(e.source_name||"").toLowerCase())c(o,W.voice(e)),a(o.data);else{var s=o.data[0];n.timeout(-1!==(e.source_name||"").toLowerCase().indexOf("mirage")?1e4:5e3),n.silent(X(s.url),(function(n){var i=n;if("string"==typeof n)try{i=JSON.parse(n)}catch(e){i={}}i.quality&&0!==Object.keys(i.quality).length?(c(o,W.voice(e)),o.data.forEach((function(e){e.quality=i.quality,e.details=i.details||e.details,e.translate=i.translate||e.translate,e.method="play"})),a(o.data)):t("no quality in call")}),(function(t){c(o,W.voice(e)),a(o.data)}),!1,{dataType:"text"})}else c(o,W.voice(e)),a(o.data)}else t("no data")}),(function(e){t(e)}),!1,{dataType:"text"})}))},m=[];e.forEach((function(e){e.source_name||e.balanser;if(e.voice&&Lampa.Arrays.isArray(e.voice)){if(e.data&&Lampa.Arrays.isArray(e.data))if(e.data.some((function(e){return"play"===e.method&&e.url}))){var a=e.voice.find((function(e){return!0===e.active}))||e.voice[0],t=a&&a.name||"";e.data.forEach((function(a){"play"===a.method&&(a.translate_name=t,a.source_name=e.source_name||e.balanser||"",m.push(a))}))}e.voice=W.filterTranslate(e.voice);var n=e.source_name||e.balanser||"";e.voice.forEach((function(e){e.source_name=e.source_name||n})),s=s.concat(e.voice.filter((function(e){return 0==l.filter((function(a){return W.voice(e).toLowerCase().indexOf(a)>=0})).length})))}})),i||(i=W.voice(s[0])),s.sort((function(e,a){return W.voice(e).toLowerCase().localeCompare(W.voice(a).toLowerCase())}));var f=s;if(0!==f.length){var d=f.filter((function(e){return W.compareVoice(e.name,i)}));0===d.length&&(d=[f[0]]),r=m.filter((function(e){return W.compareVoice(e.translate_name,i)}));var p=new o(d.length);p.onComplite=function(){var e={translates:f,plays:r};a._voiceCache[i]=e,t(e)},d.forEach((function(e){u(e).then((function(a){var t=e.source_name||"";t&&a.forEach((function(e){e.source_name||(e.source_name=t)})),r=r.concat(a),p.next()})).catch((function(e){p.next()}))}))}else n(700)}}))}},{key:"error",value:function(e){var a=Lampa.Controller.enabled().name,t=Lampa.Lang.translate("skazfix_no_content"),n=$('<div class="connect-broken">\n\t\t\t\t\t\t\t\t\t<div class="connect-broken__title">'.concat(Lampa.Lang.translate("skazfix_error_title"),'</div>\n\t\t\t\t\t\t\t\t\t<div class="connect-broken__text">').concat(t,'</div>\n\t\t\t\t\t\t\t\t\t<div class="connect-broken__footer">\n\t\t\t\t\t\t\t\t\t\t<div class="selector simple-button">').concat(Lampa.Lang.translate("skazfix_close"),"</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>"));n.find(".selector").on("hover:enter",(function(){Lampa.Controller.back()})),Lampa.Modal.open({title:"",html:n,onBack:function(){Lampa.Modal.close(),Lampa.Controller.toggle(a)}})}}]),t}();function ee(e,a){var t=0,n=0;e.forEach((function(e,a){!e.quality&&e.url&&-1!==e.url.indexOf(".m3u8")&&t++})),0!==t?e.forEach((function(i,r){if(!i.quality&&i.url&&-1!==i.url.indexOf(".m3u8")){var o=new Lampa.Reguest;o.timeout(5e3),o.native(i.url,(function(r){if("string"==typeof r&&-1!==r.indexOf("#EXT-X-STREAM-INF")){var o=function(e,a){for(var t={},n=e.split("\n"),i=null,r=0;r<n.length;r++){var o=n[r].trim();if(0===o.indexOf("#EXT-X-STREAM-INF")){var l=o.match(/RESOLUTION=(\d+)x(\d+)/i);if(l)i=parseInt(l[2]);else{var s=o.match(/BANDWIDTH=(\d+)/i);if(s){var c=parseInt(s[1]);i=c>4e6?1080:c>2e6?720:c>1e6?480:c>5e5?360:240}}}else if(i&&o&&0!==o.indexOf("#")){var u=o;if(0!==u.indexOf("http")){var m=a.split("/");m.pop(),u=m.join("/")+"/"+u}var f=i+"p";t[f]||(t[f]=u),i=null}}return t}(r,i.url);Object.keys(o).length>0&&(i.quality=o)}++n>=t&&a(e)}),(function(){++n>=t&&a(e)}),!1,{dataType:"text"})}})):a(e)}var ae=function(){function e(t){var n=this;a(this,e),this.object=t,this.extract=new Y(t),this.voice=new r(t),this.on_error_timer=null;Lampa.Player.listener.follow("destroy",(function e(){Lampa.Player.listener.remove("destroy",e),clearTimeout(n.on_error_timer)}))}return n(e,[{key:"getQuality",value:function(e){var a=this,t={},n={};e.forEach((function(e,i){var r=e.quality,o=e.source_name||"";if(!r||"object"!==_typeof(r)){if(!e.url)return;r={auto:e.url}}var l=function(e){var i=parseInt(e),l=a.getSplitLinks(r[e]);l.forEach((function(e){o&&!n[e]&&(n[e]=o)})),t[e]?(t[e].reserve=t[e].reserve.concat(l),t[e].urlSources=n):t[e]={label:i>1440?"4K":i>=1440?"2K":i>=1080?"FHD":i>=720?"HD":"",url:l[0],reserve:l.length>1?l.slice(1):[],used:[],error:[],urlSources:n,trigger:function(){a.setFlowsForQuality(Lampa.Player.playdata())}}};for(var s in r)l(s)}));var i=Lampa.Arrays.getKeys(t),r={};return i.sort((function(e,a){var t=parseInt((e+"").replace(/[^0-9]/g,""))||0,n=parseInt((a+"").replace(/[^0-9]/g,""))||0;return 0===t&&0===n?(e+"").localeCompare(a+""):0===t?1:0===n?-1:n-t})),i.forEach((function(e){var a=parseInt((e+"").replace(/[^0-9]/g,""))||0;a>0&&!t[e].label&&(t[e].label=a>1440?"4K":a>=1440?"2K":a>=1080?"FHD":a>=720?"HD":""),r[e]=t[e]})),r}},{key:"getSplitLinks",value:function(e){if("string"!=typeof e)return e&&e.url?[e.url]:[String(e)];var a=e.split(" or "),t=[];return a.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),t}},{key:"getSelectedQuality",value:function(e){var a=null,t=e.url,n=e.quality;if(e.quality_switched){for(var i in n)if(i==e.quality_switched){a=n[i];break}}else for(var i in n){var r=n[i];if(r.url==t||r.reserve.indexOf(t)>=0){a=r;break}}if(!a)for(var i in n){a=n[i];break}return a}},{key:"getQualityLevelDown",value:function(e){var a,t,n=this.getSelectedQuality(e);for(var i in e.quality)if(n==e.quality[i]){a=i;break}if(a){var r=Lampa.Arrays.getKeys(e.quality);r.sort((function(e,a){return parseInt(a)-parseInt(e)})),r.forEach((function(e){parseInt(e)<parseInt(a)&&!t&&(t=e)}))}return t}},{key:"getReserveQuality",value:function(e){var a=this.getSelectedQuality(e),t="";return a&&(a.error.push(Lampa.Manifest.app_digital>=236?e.url:a.url),a.reserve.forEach((function(e){-1!=a.used.indexOf(e)||t||(t=e,a.used.push(e))}))),t}},{key:"getPlayData",value:function(e){var a=Lampa.Utils.hash(e.season?[e.season,e.season>10?":":"",e.episode,this.object.movie.original_title].join(""):this.object.movie.original_title),t=this.getQuality(e.quality);return{title:this.object.movie.title||this.object.movie.name,url:Lampa.Player.getUrlQuality(t),quality:t,timeline:Lampa.Timeline.view(a),translate_name:e.translate,card:this.object.movie}}},{key:"getNextVoice",value:function(e,a,t){var n=this.getSelectedQuality(e);if(n&&(0==n.reserve.length||n.used.length==n.reserve.length)){var i=this.getQualityLevelDown(e);i?(e.quality_switched=i,n=this.getSelectedQuality(e),Lampa.Arrays.remove(n.reserve,n.url),Lampa.Arrays.insert(n.reserve,0,n.url)):n=null}n?(e.url=this.getReserveQuality(e),t(e.url||"nofound"),this.setFlowsForQuality(e)):W.modalChoiceTranstale({from:a.find((function(e){return e.selected})).name,voicelist:a})}},{key:"setFlowsForQuality",value:function(e){if(e&&e.quality){var a=Object.keys(e.quality);if(1!==a.length||"auto"!==a[0]){var t=this.getSelectedQuality(e);if(t){s=[];var n=[t.url].concat(t.reserve.filter((function(e){return e!==t.url}))).filter((function(e){return-1==t.error.indexOf(e)}));n.length>0&&n.forEach((function(e,a){var n=t.urlSources&&t.urlSources[e]?t.urlSources[e]:"",i=n||Lampa.Utils.shortText(e,35);s.push({title:Lampa.Lang.translate("skazfix_stream")+" "+(a+1),subtitle:i,url:e,selected:e==t.url})})),Lampa.PlayerPanel.setFlows(!!s.length&&s)}}else{var i=e.quality.auto,r=i.url||i;if("string"==typeof r&&r){var o=i.urlSources&&i.urlSources[r]?i.urlSources[r]:"",l=o||Lampa.Utils.shortText(r,35),s=[{title:Lampa.Lang.translate("skazfix_stream")+" 1",subtitle:l,url:r,selected:!0}];Lampa.PlayerPanel.setFlows(s)}}}}},{key:"movie",value:function(e){var a=this,t=W.player(),n=E()||"inner"!=t;e.translates.sort((function(e,a){var t=parseInt(e.maxquality)||0,n=parseInt(a.maxquality)||0;if(n!==t)return n-t;var i=G.filter_db.filter((function(a){return e.translate.toLowerCase().indexOf(a.toLowerCase())>=0})).length,r=G.filter_db.filter((function(e){return a.translate.toLowerCase().indexOf(e.toLowerCase())>=0})).length;return i&&!r?-1:!i&&r?1:0}));var i=this.voice.get();i||(i=W.voice(e.translates[0]));var r=e.translates.filter((function(e){return W.compareVoice(W.voice(e),i)})),o=Lampa.Utils.hash(this.object.movie.original_title);if(n){var l={};e.translates.forEach((function(e){var a=W.voice(e);l[a]||(l[a]=[]),l[a].push(e)}));var s=Object.keys(l),c={},u=0;s.forEach((function(e){a.extract.links([l[e]]).then((function(t){if(t.length>0&&(c[e]=l[e]),++u===s.length){var n=[];for(var r in c)n=n.concat(c[r]);if(0===n.length)return a.extract.error(700);W.selectChoiceTranstale(n,i,(function(e){a.voice.set(W.voice(e)),a.extract.links([n.filter((function(a){return W.compareVoice(W.voice(a),W.voice(e))}))]).then((function(e){if(0==e.length)return Lampa.Bell.push({text:Lampa.Lang.translate("skazfix_no_links"),time:5e3});var t=a.getQuality(e),n=e.find((function(e){return e.subtitles})),i=a.extract.flows(t);W.selectChoiceFlow(i,(function(e){var t={title:a.object.movie.title||a.object.movie.name,url:e.url,timeline:Lampa.Timeline.view(o),subtitles:!!n&&n.subtitles};Lampa.Player.play(t)}))})).catch((function(e){a.extract.error(e)}))}))}})).catch((function(e){if(++u===s.length){var t=[];for(var n in c)t=t.concat(c[n]);if(0===t.length)return a.extract.error(700);W.selectChoiceTranstale(t,i,(function(e){a.voice.set(W.voice(e)),a.extract.links([t.filter((function(a){return W.compareVoice(W.voice(a),W.voice(e))}))]).then((function(e){if(0==e.length)return Lampa.Bell.push({text:Lampa.Lang.translate("skazfix_no_links"),time:5e3});var t=a.getQuality(e),n=e.find((function(e){return e.subtitles})),i=a.extract.flows(t);W.selectChoiceFlow(i,(function(e){var t={title:a.object.movie.title||a.object.movie.name,url:e.url,timeline:Lampa.Timeline.view(o),subtitles:!!n&&n.subtitles};Lampa.Player.play(t)}))})).catch((function(e){a.extract.error(e)}))}))}}))}))}else"inner"==t&&a.extract.links([r]).then((function(t){ee(t,(function(t){Lampa.Player.opened()&&Lampa.Player.close();var n=[],l=a.getQuality(t),s=t.find((function(e){return e.subtitles})),c={};t.forEach((function(e){var a=e.translate_name||e.translate||"",t=e.source_name||"";a&&t&&(c[a]||(c[a]=[]),-1===c[a].indexOf(t)&&c[a].push(t))}));var u={};r.forEach((function(e){var a=e.translate,t=e.source_name||"";u[a]||(u[a]=[]),t&&-1===u[a].indexOf(t)&&u[a].push(t)}));var m={};for(var f in e.translates.forEach((function(e){var a=e.translate;m[a]||(m[a]={item:e,sources:[],maxquality:0});var t=e.source_name||"",n=!1;t&&-1===m[a].sources.indexOf(t)&&(W.compareVoice(a,i)?c[a]&&-1!==c[a].indexOf(t)&&(n=!0):n=!0),n&&m[a].sources.push(t);var r=parseInt(e.maxquality)||0;r>m[a].maxquality&&(m[a].maxquality=r)})),m){var d=m[f],p=(d.item,[]);d.sources.length>0&&p.push(d.sources.join(", ")),d.maxquality>0&&p.push(d.maxquality+"p"),n.push({selected:W.compareVoice(i,f),name:f,title:f,subtitle:p.join(" • "),onSelect:function(){a.voice.set(this.name),Lampa.Player.loading(!0),a.movie(e)}})}n.length>0&&!n.find((function(e){return e.selected}))&&(n[0].selected=!0);var h={title:a.object.movie.title||a.object.movie.name,url:t.length?Lampa.Player.getUrlQuality(l):"nofound",quality:l,timeline:Lampa.Timeline.view(o),subtitles:!!s&&s.subtitles,card:a.object.movie,voiceovers:n,error:function(e,t){a.on_error_timer=setTimeout((function(){a.getNextVoice(e,n,t)}),2e3)}};Lampa.Player.runas("inner"),Lampa.Player.play(h),Lampa.Player.playlist([]),a.setFlowsForQuality(h)}))}))}},{key:"tv",value:function(e,a,t,n){var i=this,r=[],o=[],l=this.voice.get();Lampa.Controller.toggle("content"),W.sortDUBTranstale(e.translates);var s={};for(var c in e.translates.forEach((function(e){var a=e.name;s[a]||(s[a]={item:e,sources:[],maxquality:0});var t=e.source_name||"";t&&-1===s[a].sources.indexOf(t)&&s[a].sources.push(t);var n=parseInt(e.maxquality)||0;n>s[a].maxquality&&(s[a].maxquality=n)})),s){var u=s[c];u.item;!function(n,r,s){var c=[];r.sources.length>0&&c.push(r.sources.join(", ")),r.maxquality>0&&c.push(r.maxquality+"p"),o.push({name:n,title:n,subtitle:c.join(" • "),selected:W.compareVoice(n,l),onSelect:function(){i.voice.set(n),Lampa.Player.loading(!0),i.extract.voice(e.sources).then((function(n){n.sources=e.sources,i.tv(n,a,t)})).catch((function(e){})).finally((function(){Lampa.Player.loading(!1)}))}})}(c,u)}o.length>0&&!o.find((function(e){return e.selected}))&&(o[0].selected=!0),a.forEach((function(a){if(e.plays.find((function(e){return e.e==a.number}))){var l={number:a.number,season:n,episode:a.number,title:a.title,timeline:a.timeline,launch_player:"inner",url:function(t){var r=W.player(),s=E();j();if(s||"inner"!=r)W.selectChoiceTranstale(e.translates,W.voice(o.find((function(e){return e.selected}))),(function(t){i.voice.set(W.voice(t)),i.extract.voice(e.sources).then((function(e){var t=e.plays.filter((function(e){return e.e==a.number}));return i.extract.links([t])})).then((function(e){if(0==e.length)throw new Error(700);var t=i.getQuality(e),r=e.find((function(e){return e.subtitles})),o=i.extract.flows(t);W.selectChoiceFlow(o,(function(e){var t={title:a.title,season:n,episode:a.number,url:e.url,timeline:a.timeline,subtitles:!!r&&r.subtitles};a.mark(),Lampa.Player.play(t)}))})).catch((function(e){i.extract.error(e)}))}));else if("inner"==r){Lampa.Player.loading(!0);var c=o.find((function(e){return e.selected})),u=c?c.name:"";i.extract.links([e.plays.filter((function(e){return e.e==a.number&&W.compareVoice(e.translate_name,u)}))]).then((function(e){0==e.length?(l.url="nofound",t()):(l.quality=i.getQuality(e),l.url=Lampa.Player.getUrlQuality(l.quality),t(),setTimeout((function(){i.setFlowsForQuality({url:"string"==typeof l.url?l.url:"",quality:l.quality,quality_switched:null})}),100))})).catch((function(){l.url="nofound",t()})).finally((function(){Lampa.Player.loading(!1)}))}},card:i.object.movie,voiceovers:o,callback:function(){a.mark(),t=a},error:function(e,a){i.on_error_timer=setTimeout((function(){i.getNextVoice(e,o,a)}),2e3)}};r.push(l)}}));var m=r.find((function(e){return e.number==t.number}));if(!m)return W.modalChoiceTranstale({from:o.find((function(e){return e.selected})).name,voicelist:o});m.url((function(){Lampa.Player.opened()&&Lampa.Player.close(),Lampa.Player.runas("inner"),Lampa.Player.play(m),Lampa.Player.playlist(r),m.quality&&Object.keys(m.quality).length>0&&i.setFlowsForQuality({url:"string"==typeof m.url?m.url:"",quality:m.quality,quality_switched:null})}))}}]),e}(),te=function(){function e(t){a(this,e);this.object=t,this.startPlay()}return n(e,[{key:"startPlay",value:function(){this.object.movie.name?(v=this.object.movie.id||null,this.tv()):(v=null,this.movie())}},{key:"movie",value:function(){var e=this,a=new ae(this.object);!function(){P();var t=function(){var n=A(),i=new Y(e.object);i.movie({movie:e.object.movie,type:"movie"}).then((function(t){P(),Lampa.Favorite.add("history",e.object.movie,100),a.movie(t)})).catch((function(e){T(n),q()?(Lampa.Noty.show("Пробуем другой сервер..."),t()):(P(),i.error(e))}))};t()}()}},{key:"tv",value:function(){Lampa.Activity.push({url:"",title:"",component:"episodes",movie:this.object.movie,page:1})}}]),e}(),ne={};function ie(e){var a,t=new Lampa.Explorer(e),n=new Lampa.Filter(e),i=new Lampa.Scroll({mask:!0,over:!0}),r={season:1},o=e.movie.number_of_seasons||1,s=!1,c=!1,u=null,m=null;this.create=function(){var a=this;this.getChoice(),t.appendFiles(i.render()),t.appendHead(n.render()),i.body().addClass("torrent-list mapping--list"),t.render().find(".filter--search, .filter--sort").remove(),i.minus(t.render().find(".explorer__files-head")),this.activity.loader(!0);var u=e.movie.id,m=e.movie.imdb_id,f=e.movie.tvdb_id,d=l.getSeasonsCount(u);function p(){s||Lampa.Api.seasons(e.movie,[1],(function(e){if(!s){if(e[1]&&e[1].seasons_count&&e[1].seasons_count>o&&(o=e[1].seasons_count),!c){var t=l.getSeasonsCount(u);t&&t>o&&(o=t)}s=!0,a.filter(),a.selected(),a.activity.loader(!1),e[1]&&e[1].episodes&&e[1].episodes.length&&1===r.season?a.draw(e[1].episodes):a.load()}}))}return d?(o=d,c=!0,p()):(l.fetch(u,m,f,(function(e){c=!0,e&&e>o&&(o=e),p()})),setTimeout((function(){s||p()}),3e3)),this.activity.toggle(),this.render()},this.setChoice=function(a){r.season=a;var t=Lampa.Storage.cache("season_choice","{}",1e3);t[e.movie.id]=a,Lampa.Storage.set("season_choice",t)},this.getChoice=function(){var a=Lampa.Storage.get("season_choice","{}");a[e.movie.id]&&(r.season=Math.max(1,a[e.movie.id]),s&&r.season>o&&(r.season=o))},this.filter=function(){var e=this;n.addButtonBack(),n.onSelect=function(a,t){e.setChoice(t.season),e.selected(),u=null,m=null,Lampa.Controller.toggle("content"),e.load()},n.onBack=function(){e.start()}},this.selected=function(){var e=[],a=[];for(var t in r)"season"==t&&e.push(Lampa.Lang.translate("torrent_serial_season")+": "+r[t]);for(var i=0;i<o;i++)a.push({title:Lampa.Lang.translate("torrent_serial_season")+" "+(i+1),season:i+1,selected:r.season==i+1});n.set("filter",a),n.chosen("filter",e)},this.load=function(){var t=this;this.activity.loader(!0);var n=r.season;Lampa.Api.clear(),Lampa.Api.seasons(e.movie,[n],(function(e){a=!1,i.clear(),i.reset(),e[n]&&e[n].episodes&&e[n].episodes.length?t.draw(e[n].episodes):t.empty(),t.activity.loader(!1)}))},this.empty=function(){var e=Lampa.Template.get("empty_filter"),a=$('<div class="simple-button selector"><span>'+Lampa.Lang.translate("filter_clarify")+"</span></div>");a.on("hover:enter",(function(){n.render().find(".filter--filter").trigger("hover:enter")})),e.find(".empty-filter__title").remove(),e.find(".empty-filter__buttons").removeClass("hide").append(a),i.append(e),Lampa.Controller.enable("content")},this.draw=function(t){t.forEach((function(n,o){var s=n.episode_number||o+1,c=Lampa.Utils.hash([r.season,r.season>10?":":"",s,e.movie.original_title].join("")),f=[],d=new Date((n.air_date+"").replace(/-/g,"/")),p=Date.now(),h=n.air_date?Math.round((d.getTime()-p)/864e5):1,v=Lampa.Lang.translate("full_episode_days_left")+": "+(n.air_date?h:"- -");n.timeline=Lampa.Timeline.view(c),n.time=Lampa.Utils.secondsToTime(60*n.runtime,!0),n.title=n.name||Lampa.Lang.translate("torrent_serial_episode")+" "+s,n.quality=h>0?v:"",n.number=s,n.vote_average&&f.push(Lampa.Template.get("season_episode_rate",{rate:parseFloat(n.vote_average+"").toFixed(1)},!0)),n.air_date&&f.push(Lampa.Utils.parseTime(n.air_date).full),n.info=f.length?f.map((function(e){return"<span>"+e+"</span>"})).join('<span class="season-episode-split">●</span>'):"";var y=Lampa.Template.get("season_episode",n),g=y.find(".season-episode__loader"),_=y.find(".season-episode__img"),k=function(e){y.find(".season-episode__viewed").remove(),(Boolean(n.timeline.percent)||e)&&y.find(".season-episode__img").append('<div class="season-episode__viewed">'+Lampa.Template.get("icon_viewed",{},!0)+"</div>")};n.mark=function(){a=y[0],k(!0)},n.unmark=function(){y.find(".season-episode__viewed").remove()},n.timeclear=function(){n.timeline.percent=0,n.timeline.time=0,n.timeline.duration=0,Lampa.Timeline.update(n.timeline),y.find(".season-episode__timeline").empty().append(Lampa.Timeline.render(n.timeline))},y.find(".season-episode__timeline").append(Lampa.Timeline.render(n.timeline)),h>0?y.css("opacity","0.5"):(k(),Boolean(n.timeline.percent)&&(a=y[0]),y.on("hover:enter",(function(){var o=new ae(e),l=e.movie.id+"_"+r.season;if(u&&m===r.season)return Lampa.Favorite.add("history",e.movie,100),o.tv(u,t,n,r.season),n.mark(),void Lampa.Player.callback((function(){i.update($(a),!0),Lampa.Controller.toggle("content")}));if(ne[l])return u=ne[l],m=r.season,Lampa.Favorite.add("history",e.movie,100),o.tv(u,t,n,r.season),n.mark(),void Lampa.Player.callback((function(){i.update($(a),!0),Lampa.Controller.toggle("content")}));!function(){P();var c=function(){var f=A(),d=new Y(e);d.tv({movie:e.movie,season:r.season,episode:s,type:"episode"}).then((function(s){P(),u=s,m=r.season,ne[l]=s,Lampa.Favorite.add("history",e.movie,100),o.tv(s,t,n,r.season),n.mark(),Lampa.Player.callback((function(){i.update($(a),!0),Lampa.Controller.toggle("content")}))})).catch((function(e){T(f),q()?(Lampa.Noty.show("Пробуем другой сервер..."),c()):(P(),d.error(e))}))};c()}()}))),y.on("hover:focus",(function(e){a=e.target,i.update($(e.target),!0)})).on("visible",(function(){var e=y.find("img")[0];e.onerror=function(){e.src="./img/img_broken.svg"},e.onload=function(){_.addClass("season-episode__img--loaded"),g.remove(),_.append('<div class="season-episode__episode-number">'+("0"+s).slice(-2)+"</div>")},n.still_path?e.src=Lampa.TMDB.image("t/p/w300"+n.still_path):n.img?e.src=n.img:(g.remove(),_.append('<div class="season-episode__episode-number">'+("0"+s).slice(-2)+"</div>"))})).on("hover:hover hover:touch",(function(e){a=e.target,Navigator.focused(a)})).on("hover:long",(function(){var e=Lampa.Controller.enabled().name,a=[];a.push({title:Lampa.Lang.translate("skazfix_mark"),mark:!0}),a.push({title:Lampa.Lang.translate("skazfix_unmark"),unmark:!0}),a.push({title:Lampa.Lang.translate("skazfix_timeclear"),timeclear:!0}),a.push({title:Lampa.Lang.translate("skazfix_more"),separator:!0}),a.push({title:Lampa.Lang.translate("skazfix_clearallmark"),clearallmark:!0}),a.push({title:Lampa.Lang.translate("skazfix_clearalltime"),clearalltime:!0}),a.push({title:Lampa.Lang.translate("skazfix_reset_section"),separator:!0}),j()&&a.push({title:Lampa.Lang.translate("skazfix_reset_remembered"),resetremembered:!0}),a.push({title:Lampa.Lang.translate("skazfix_clear_cache"),clearcache:!0}),Lampa.Select.show({title:Lampa.Lang.translate("skazfix_action"),items:a,onBack:function(){Lampa.Controller.toggle(e)},onSelect:function(a){Lampa.Controller.toggle(e),a.mark&&n.mark(),a.unmark&&n.unmark(),a.timeclear&&n.timeclear(),a.clearallmark&&t.forEach((function(e){e.unmark&&e.unmark()})),a.clearalltime&&t.forEach((function(e){e.timeclear&&e.timeclear()})),a.resetremembered&&(I(),Lampa.Noty.show(Lampa.Lang.translate("skazfix_remembered_reset_done"))),a.clearcache&&(Object.keys(ne).forEach((function(e){delete ne[e]})),u=null,m=null,l.cache={},Lampa.Noty.show(Lampa.Lang.translate("skazfix_cache_cleared")))}})})),i.append(y)})),a&&i.update($(a),!0),Lampa.Layer.visible(i.render(!0)),Lampa.Controller.enable("content")},this.start=function(){Lampa.Activity.active().activity===this.activity&&(Lampa.Background.immediately(Lampa.Utils.cardImgBackgroundBlur(e.movie)),Lampa.Controller.add("content",{toggle:function(){Lampa.Controller.collectionSet(i.render(),t.render()),Lampa.Controller.collectionFocus(a||!1,i.render())},left:function(){t.toggle()},right:function(){n.show(Lampa.Lang.translate("title_filter"),"filter")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:function(){Lampa.Activity.backward()}}),Lampa.Controller.toggle("content"))},this.pause=function(){},this.stop=function(){},this.render=function(){return t.render()},this.destroy=function(){i.destroy(),n.destroy(),t.destroy();try{Lampa.Api.clear()}catch(e){}}}function re(){Lampa.Settings.listener.follow("open",(function(e){"main"==e.name&&(0==Lampa.Settings.main().render().find('[data-component="online_settings"]').length&&Lampa.SettingsApi.addComponent({component:"online_settings",name:Lampa.Lang.translate("skazfix_online_title"),icon:y,before:"interface"}),Lampa.Settings.main().update())})),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_mode_title",type:"title"},field:{name:Lampa.Lang.translate("skazfix_work_mode")}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_always_show_choices_toggle",type:"trigger",default:!1},field:{name:Lampa.Lang.translate("skazfix_always_show_choices"),description:Lampa.Lang.translate("skazfix_always_show_choices_desc")},onChange:function(e){F(e)},onRender:function(e){e.find(".settings-param__value").text(E()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no")),e.on("hover:enter",(function(){F(!E()),e.find(".settings-param__value").text(E()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no"))}))}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_remember_choices_toggle",type:"trigger",default:!1},field:{name:Lampa.Lang.translate("skazfix_remember_choices"),description:Lampa.Lang.translate("skazfix_remember_choices_desc")},onChange:function(e){D(e)},onRender:function(e){e.find(".settings-param__value").text(j()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no")),e.on("hover:enter",(function(){D(!j()),j()||I(),e.find(".settings-param__value").text(j()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no"))}))}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_sources_title",type:"title"},field:{name:Lampa.Lang.translate("skazfix_sources_title")}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_sources_btn",type:"static"},field:{name:Lampa.Lang.translate("skazfix_choose_sources"),description:Lampa.Lang.translate("skazfix_choose_balancers")},onRender:function(e){e.on("hover:enter",(function(){oe()}))}})}function oe(e){var a=Lampa.Controller.enabled().name,t=L(),n=x(),i=[];i.push({title:Lampa.Lang.translate("skazfix_reset_default"),reset:!0}),g.forEach((function(e){if(e.enabled&&!e.anime){var a=Lampa.Arrays.isArray(e.id)?e.id[0]:e.id;i.push({title:e.name,source:a,checkbox:!0,checked:-1!==t.indexOf(a),isAnime:!1})}})),g.some((function(e){return e.enabled&&e.anime}))&&(i.push({title:Lampa.Lang.translate("skazfix_anime_title"),separator:!0}),g.forEach((function(e){if(e.enabled&&e.anime){var a=Lampa.Arrays.isArray(e.id)?e.id[0]:e.id;i.push({title:e.name,source:a,checkbox:!0,checked:-1!==n.indexOf(a),isAnime:!0})}}))),Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_sources"),items:i,onBack:function(){var t=i.filter((function(e){return e.checkbox&&e.checked&&!e.isAnime})).map((function(e){return e.source})),n=i.filter((function(e){return e.checkbox&&e.checked&&e.isAnime})).map((function(e){return e.source}));0===t.length&&(t=_()),0===n.length&&(n=k()),b(t),S(n),Lampa.Controller.toggle(a),e&&e()},onSelect:function(a){if(!a.separator){if(a.reset){var t=_(),n=k();return i.forEach((function(e){e.checkbox&&!e.isAnime&&(e.checked=-1!==t.indexOf(e.source)),e.checkbox&&e.isAnime&&(e.checked=-1!==n.indexOf(e.source))})),b(t),S(n),Lampa.Noty.show(Lampa.Lang.translate("skazfix_sources_reset")),Lampa.Select.close(),void oe(e)}a.checked=!a.checked}}})}!function(){if(!window.plugin_init){window.plugin_init=!0,re(),Lampa.Component.add("episodes",ie),Lampa.VPN.region((function(){})),Lampa.Listener.follow("full",(function(e){if("complite"==e.type){var a='<div class="full-start__button selector view--online">'+y+"<span>"+Lampa.Lang.translate("skazfix_online")+"</span></div>",t=$(Lampa.Lang.translate(a));e.object.activity.render().find(".view--torrent").after(t),t.on("hover:enter",(function(){Lampa.Controller.toggle("content"),new te(e.data)}))}}));$("body").append("\n\t\t\t<style>\n\t\t\t\t.connect-broken {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tpadding-bottom: 1em;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__title {\n\t\t\t\t\tfont-size: 2em;\n\t\t\t\t\tline-height: 1.4;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__text {\n\t\t\t\t\tfont-size: 1.2em;\n\t\t\t\t\tpadding-top: 1em;\n\t\t\t\t\tline-height: 1.4;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__footer {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmargin-top: 2em;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__footer .simple-button {\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\n\t\t\t\t.selectbox-item__subtitle {\n\t\t\t\t\topacity: 0.5;\n\t\t\t\t}\n\t\t\t</style>\n\t\t")}}()}();
