"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(){function e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=function(){function e(a){t(this,e),this.hash=Lampa.Utils.hash(a.movie.original_title),this.field="online_selected_voice"}return n(e,[{key:"get",value:function(){return Lampa.Storage.get(this.field,"{}")[this.hash]||""}},{key:"set",value:function(e){var t=Lampa.Storage.get(this.field,"{}");t[this.hash]=e,Lampa.Storage.set(this.field,t)}}]),e}();function o(e){this.data={},this.work=0,this.need=e,this.complited=!1,this.check=function(){this.stopped||this.work>=this.need&&!this.complited&&(this.complited=!0,this.onComplite(this.data))},this.next=function(){this.work++,this.check()},this.append=function(e,t){this.work++,this.data[e]=t,this.check()},this.error=function(){this.work++,this.check()},this.stop=function(){this.stopped=!0}}var l={cache:{},pending:{},getCache:function(){return window.SEASON_FIX&&window.SEASON_FIX.tvmaze_cache?window.SEASON_FIX.tvmaze_cache:this.cache},getSeasonsCount:function(e){var t=this.getCache()[e];return t&&"object"===_typeof(t)&&Object.keys(t).length>0?Object.keys(t).length:null},fetch:function(e,t,a,n){var i=this,r=this.getCache();if(r[e]&&"object"===_typeof(r[e]))n&&n(Object.keys(r[e]).length);else if("loading"===r[e]||this.pending[e])n&&(this.pending[e]||(this.pending[e]=[]),this.pending[e].push(n));else{r[e]="loading",n&&(this.pending[e]=[n]);t||a?this.fetchFromTvmaze(e,t,a):this.fetchExternalIds(e,(function(t){t&&(t.imdb_id||t.tvdb_id)?i.fetchFromTvmaze(e,t.imdb_id,t.tvdb_id):i.finishPending(e,null)}))}},fetchExternalIds:function(e,t){var a=Lampa.TMDB&&Lampa.TMDB.key?Lampa.TMDB.key():null;if(a){var n=Lampa.TMDB&&Lampa.TMDB.api?Lampa.TMDB.api("tv/"+e+"/external_ids?api_key="+a):"https://api.themoviedb.org/3/tv/"+e+"/external_ids?api_key="+a;this.request(n,t)}else t(null)},fetchFromTvmaze:function(e,t,a){var n=this,i=t||a;if(i){var r="https://api.tvmaze.com/lookup/shows?"+(t?"imdb":"thetvdb")+"="+i;this.request(r,(function(t){if(t&&t.id){var a="https://api.tvmaze.com/shows/"+t.id+"/episodes";n.request(a,(function(t){if(t&&t.length){for(var a={},i=0;i<t.length;i++){var r=t[i].season;a[r]||(a[r]=0),a[r]++}var o=n.getCache();Object.keys(a).length>0?(o[e]=a,n.finishPending(e,Object.keys(a).length)):(delete o[e],n.finishPending(e,null))}else n.finishPending(e,null)}))}else n.finishPending(e,null)}))}else this.finishPending(e,null)},finishPending:function(e,t){var a=this.getCache();"loading"===a[e]&&delete a[e];var n=this.pending[e];delete this.pending[e],n&&n.length&&n.forEach((function(e){e(t)}))},request:function(e,t){var a=new Lampa.Reguest;a.timeout(1e4);var n=function(e){t(e)},i=function(){t(null)};-1!==e.indexOf("themoviedb.org")||-1!==e.indexOf("apitmdb.")?a.silent(e,n,i):a.native(e,n,i)}},s=["Анастасия Гайдаржи + Андрей Юрченко","Студии Суверенного Лепрозория","IgVin &amp; Solncekleshka","Студия Пиратского Дубляжа","Gremlin Creative Studio","Alternative Production","Bubble Dubbing Company","HelloMickey Production","Н.Севастьянов seva1988","XDUB Dorama + Колобок","Мобильное телевидение","СПД - Сладкая парочка","BBC Saint-Petersburg","Black Street Records","Intra Communications","Melodic Voice Studio","Selena International","Voice Project Studio","Несмертельное оружие","Петербургский дубляж","Asian Miracle Group","Lizard Cinema Trade","National Geographic","Studio Victory Аsia","True Dubbing Studio","Позитив-Мультимедиа","Премьер Мультимедиа","Уолт Дисней Компани","Family Fan Edition","Paramount Pictures","Parovoz Production","Shadow Dub Project","The Kitchen Russia","Zone Vision Studio","Анастасия Гайдаржи","Иванова и П. Пашут","Малиновский Сергей","Так Треба Продакшн","Back Board Cinema","Paramount Channel","Project Web Mania","RedDiamond Studio","Universal Channel","Zoomvision Studio","НеЗупиняйПродакшн","Селена Интернешнл","Студия «Стартрек»","Хихикающий доктор","Четыре в квадрате","Brain Production","Cowabunga Studio","Lucky Production","MC Entertainment","Paramount Comedy","Universal Russia","Анатолий Ашмарин","Андрей Питерский","Васька Куролесов","Екатеринбург Арт","Квадрат Малевича","Первый канал ОРТ","Реальный перевод","Русский Репортаж","Сolumbia Service","Amazing Dubbing","AnimeSpace Team","Cartoon Network","Cinema Prestige","CinemaSET GROUP","DeadLine Studio","DeeAFilm Studio","GreenРай Studio","New Dream Media","Sunshine Studio","Volume-6 Studio","XvidClub Studio","Антонов Николай","Воробьев Сергей","Денис Шадинский","З Ранку До Ночі","Максим Логинофф","Николай Дроздов","Студия Горького","Студийная банда","Ульпаней Эльром","Agatha Studdio","Anything-group","CrazyCatStudio","Creative Sound","DIVA Universal","Garsu Pasaulis","GoodTime Media","Goodtime Media","Hamster Studio","Horizon Studio","Jakob Bellmann","Julia Prosenuk","KosharaSerials","Kulzvuk Studio","Mallorn Studio","Red Head Sound","RedRussian1337","SovetRomantica","SunshineStudio","Syfy Universal","TUMBLER Studio","Viasat History","visanti-vasaer","Анатолий Гусев","Вартан Дохалов","Витя «говорун»","Кирдин | Stalk","Л. Володарский","Леша Прапорщик","Максим Жолобов","Медиа-Комплекс","Прайд Продакшн","Русский дубляж","Союзмультфильм","Студия Колобок","5-й канал СПб","ARRU Workshop","Arasi project","Banyan Studio","Bars MacAdams","Bonsai Studio","Byako Records","Dream Records","FiliZa Studio","Filiza Studio","Film Prestige","Flarrow Films","Gezell Studio","Greb&Creative","HamsterStudio","Jetvis Studio","LE-Production","Lizard Cinema","Nazel & Freya","PCB Translate","Rainbow World","Renegade Team","SHIZA Project","Sci-Fi Russia","Amanogawa","The Mike Rec.","VIP Serial HD","VO-Production","VO-production","Victory-Films","ViruseProject","Voice Project","Vulpes Vulpes","АРК-ТВ Studio","Видеопродакшн","Мадлен Дюваль","Мика Бондарик","Наталья Гурзо","Премьер Видео","Семыкина Юлия","Старый Бильбо","Трамвай-фильм","Фортуна-Фильм","Хоррор Мэйкер","Храм Дорам ТВ","Штамп Дмитрий","A. Lazarchuk","AlphaProject","AniLibria.TV","AnimeReactor","Animereactor","BadCatStudio","DreamRecords","General Film","HaseRiLLoPaW","Horror Maker","Ivnet Cinema","Korean Craze","Light Breeze","Mystery Film","Oneinchnales","Profix Media","Psychotronic","RG Paravozik","RG.Paravozik","RussianGuy27","Sony Channel","Train Studio","Trdlo.studio","ViP Premiere","VictoryFilms","VulpesVulpes","Wayland team","sweet couple","Альтера Парс","Видеоимпульс","Гей Кино Гид","Говинда Рага","Деваль Видео","Е. Хрусталёв","К. Поздняков","Кармен Видео","Кинопремьера","Кирилл Сагач","КонтентикOFF","Кубик в Кубе","Кураж-Бамбей","Мьюзик-трейд","Н. Золотухин","Не требуется","Новый Дубляж","Нурмухаметов","Первый канал","Р. Янкелевич","С. Кузьмичёв","С. Щегольков","Сергей Дидок","Синема Трейд","Синта Рурони","Студия Райдо","Тоникс Медиа","Точка Zрения","Фильмэкспорт","Элегия фильм","1001 cinema","BTI Studios","Cactus Team","CrezaStudio","Crunchyroll","DVD Classic","Description","Eurochannel","FocusStudio","Franek Monk","Gala Voices","Gears Media","GladiolusTV","Gold Cinema","Good People","HiWay Grope","Inter Video","JWA Project","Lazer Video","Max Nabokov","NEON Studio","Neoclassica","New Records","Nickelodeon","Nika Lenina","Oghra-Brown","Paul Bunyan","Rebel Voice","RecentFilms","RiZZ_fisher","Saint Sound","SakuraNight","SnowRecords","Sony Sci-Fi","Sound-Group","StudioFilms","TF-AniGroup","TrainStudio","XDUB Dorama","Zone Studio","Zone Vision","hungry_inri","Варус Видео","Варус-Видео","Видеосервис","Володарский","Г. Либергал","Г. Румянцев","Другое кино","Е. Гаевский","Завгородний","И. Сафронов","И. Степанов","Кенс Матвей","КураСгречей","Лазер Видео","Малиновский","Мастер Тэйп","Неоклассика","Новый Канал","Огородников","Петербуржец","Прямостанов","С. Визгунов","С. Кузнецов","Севастьянов","Студия Трёх","Цікава Ідея","Эй Би Видео","Я. Беллманн","1001cinema","1WinStudio","AXN Sci-Fi","AimaksaLTV","Animegroup","ApofysTeam","AvePremier","BraveSound","CP Digital","CactusTeam","CinemaTone","Contentica","CoralMedia","DniproFilm","ELEKTRI4KA","East Dream","Fox Russia","HiWayGrope","LevshaFilm","MaxMeister","Mega-Anime","MifSnaiper","NewStation","Nice-Media","Pazl Voice","PiratVoice","Postmodern","Rain Death","Reanimedia","Shachiburi","SilverSnow","Sky Voices","SkyeFilmTV","Sony Turbo","Sound Film","StudioBand","TatamiFilm","VGM Studio","VSI Moscow","VoicePower","West Video","W³: voices","eraserhead","Б. Федоров","Бусов Глеб","Ващенко С.","Глуховский","Держиморда","Е. Гранкин","И. Еремеев","Интерфильм","Инфо-фильм","К. Филонов","Карповский","Комедия ТВ","Костюкевич","Мост Видео","Мост-Видео","Н. Антонов","Н. Дроздов","Новый диск","Ох! Студия","Первый ТВЧ","Переводман","С. Казаков","С. Лебедев","С. Макашов","Саня Белый","Союз Видео","Студия NLS","Т.О Друзей","ТВ XXI век","Толстобров","Хуан Рохас","Электричка","Ю. Немахов","диктор CDV","3df voice","AAA-Sound","Andre1288","AniLibria","AniPLague","Astana TV","AveBrasil","AveDorama","BeniAffet","CBS Drama","CLS Media","CasStudio","Discovery","DoubleRec","Epic Team","FanStudio","FilmsClub","Flux-Team","Fox Crime","GREEN TEA","Ghostface","GoodVideo","Gramalant","HighHopes","INTERFILM","JoyStudio","KinoGolos","Kinomania","Kobayashi","LakeFilms","Neo-Sound","NewComers","NewStudio","No-Future","Novamedia","OnisFilms","Persona99","RATTLEBOX","RainDeath","Red Media","SDI Media","SOLDLUCK2","Sawyer888","Sedorelli","Seoul Bay","Sephiroth","ShinkaDan","SmallFilm","SpaceDust","Timecraft","Total DVD","VIZ Media","Video-BIZ","Videogram","fiendover","turok1990","ААА-sound","Амальгама","АрхиТеатр","Васильцев","Весельчак","Видеобаза","Воротилин","Григорьев","Деньщиков","ЕА Синема","Зереницын","Золотухин","И. Клушин","Имидж-Арт","Карапетян","Киномания","Кириллица","Машинский","Мительман","Муравский","Невафильм","Останкино","Причудики","Рыжий пес","С. Дьяков","СВ Студия","СВ-Студия","Самарский","Синема УС","Советский","Солодухин","ТО Друзей","Формат AB","Хрусталев","Шадинский","Ю. Сербин","Ю. Товбин","Янкелевич","AB-Video","ALEKS KV","ANIvoice","AdiSound","AlexFilm","Amalgama","AniMaunt","AniMedia","Animedub","AuraFilm","AzOnFilm","Barin101","ClubFATE","ColdFilm","DeadLine","DexterTV","Extrabit","FilmGate","Fox Life","Foxlight","GetSmart","GoldTeam","GostFilm","Gravi-TV","Hallmark","IdeaFilm","ImageArt","JeFerSon","Jimmy J.","Kerems13","KinoView","Loginoff","LostFilm","MOYGOLOS","Marclail","Milirina","MiraiDub","Murzilka","NovaFilm","OMSKBIRD","Omskbird","Radamant","RealFake","RoxMarty","STEPonee","SorzTeam","Superbit","TurkStar","Ultradox","VashMax2","VendettA","VideoBIZ","WestFilm","XL Media","kubik&ko","metalrus","st.Elrom","Алексеев","Артемьев","АрхиАзия","Бахурани","Бессонов","Васильев","Визгунов","Войсовер","Воронцов","Гаврилов","Гаевский","Горчаков","Дольский","Домашний","Дубровин","Дьяконов","Е. Лурье","Е. Рудой","Журавлев","Заугаров","Индия ТВ","Ист-Вест","Карусель","Кинолюкс","Кузнецов","ЛанселаП","Лексикон","Ленфильм","Либергал","Логинофф","Марченко","Махонько","Медведев","Мельница","Мосфильм","Нарышкин","Оверлорд","Оригинал","Пирамида","С. Рябов","СВ-Дубль","Савченко","Субтитры","Супербит","Тимофеев","Толмачев","Хлопушка","Ю. Живов","5 канал","Amalgam","AniFilm","AniStar","AniWayt","Anifilm","Anistar","AnyFilm","AveTurk","BadBajo","BaibaKo","BukeDub","DeadSno","ELYSIUM","Eladiel","Elysium","F-TRAIN","FireDub","FoxLife","HDrezka","Hamster","Janetta","Jaskier","Kолобок","LeDoyen","Levelin","Liga HQ","Lord32x","MUZOBOZ","Macross","McElroy","MixFilm","NemFilm","Netflix","Octopus","Onibaku","OpenDub","Paradox","PashaUp","RUSCICO","RusFilm","SOFTBOX","Sam2007","SesDizi","ShowJet","SoftBox","SomeWax","TV 1000","TVShows","To4kaTV","Trina_D","Twister","Urasiko","VicTeam","Wakanim","ZM-SHOW","ZM-Show","datynet","lord666","sf@irat","Абдулов","Багичев","Бибиков","Ващенко","Герусов","Данилов","Дасевич","Дохалов","Кипарис","Клюквин","Колобок","Королев","Королёв","Латышев","Люсьена","Матвеев","Михалев","Морозов","Назаров","Немахов","Никитин","Омикрон","Ошурков","Парадиз","Пепелац","Пифагор","Позитив","Пятница","РуФилмс","Рутилов","СВ-Кадр","Синхрон","Смирнов","Сокуров","Сонотек","Сонькин","Сыендук","Филонов","Хихидок","Яковлев","Яроцкий","заКАДРЫ","100 ТВ","4u2ges","Alezan","Amedia","Ancord","AniDUB","Anubis","Azazel","BD CEE","Berial","Boльгa","Cuba77","D.I.M.","DubLik","Dubляж","Elegia","Emslie","FocusX","GalVid","Gemini","Jetvis","JimmyJ","KANSAI","KOleso","Kansai","Kiitos","L0cDoG","LeXiKC","Lisitz","Mikail","Milvus","MrRose","Nastia","NewDub","OSLIKt","Ozz TV","Ozz.tv","Prolix","RedDog","Rumble","SNK-TV","Satkur","Selena","Shaman","Stevie","Suzaku","TV1000","Tycoon","UAFlix","WVoice","WiaDUB","ZEE TV","Zendos","Zerzia","binjak","den904","kiitos","madrid","neko64","АБыГДе","Агапов","Акалит","Акопян","Акцент","Альянс","Анубис","Арк-ТВ","Бойков","Векшин","Вихров","Вольга","Гоблин","Готлиб","Гризли","Гундос","Гуртом","ДиоНиК","Дьяков","Есарев","Живаго","Жучков","Зебуро","Иванов","Карцев","Кашкин","Килька","Киреев","Козлов","Кондор","Котова","Кошкин","Кравец","Курдов","Лагута","Лапшин","Лизард","Миняев","Мудров","Н-Кино","НЕВА 1","НЛО-TV","Набиев","Нева-1","Пронин","Пучков","Ракурс","Россия","С.Р.И.","Санаев","Светла","Сербин","Стасюк","Строев","ТВ СПб","Товбин","Шварко","Швецов","Шуваев","Amber","AniUA","Anika","Arisu","Cmert","D2Lab","D2lab","DeMon","Elrom","IНТЕР","JetiX","Jetix","Kerob","Lupin","Ozeon","PaDet","RinGo","Ryc99","SHIZA","Solod","To4ka","erogg","ko136","seqw0","ssvss","zamez","Акира","АнВад","Белов","Бигыч","ВГТРК","Велес","Ворон","Гланц","Живов","Игмар","Интер","Котов","Лайко","Мишин","Новий","Перец","Попов","Райдо","РенТВ","Рудой","Рукин","Рыбин","Рябов","С.Р.И","ТВЧ 1","Хабар","Чадов","Штамп","Штейн","Andy","CPIG","Dice","ETV+","Gits","ICTV","Jade","KIHO","Laci","RAIM","SGEV","Tori","Troy","Twix","Vano","Voiz","jept","ИДДК","Инис","Ирэн","Нота","ТВ-3","ТВИН","Твин","Чуев","1+1","2+2","2x2","2х2","AMC","AMS","AOS","CDV","DDV","FDV","FOX","ICG","IVI","JAM","LDV","MCA","MGM","MTV","Oni","QTV","TB5","V1R","VHS","АМС","ГКГ","ДТВ","ИГМ","КТК","МИР","НСТ","НТВ","НТН","РТР","СТС","ТВ3","ТВ6","ТВЦ","ТНТ","ТРК","Че!","D1","R5","К9","Закадровый","Многоголосый"];s.sort((function(e,t){return t.length-e.length})),Lampa.Lang.add({skazfix_wait:{ru:"Секундочку...",en:"Wait a moment...",uk:"Секундочку...",zh:"稍等..."},skazfix_error_title:{ru:"Вот досада...",en:"What a pity...",uk:"От прикрість...",zh:"真遗憾..."},skazfix_no_files:{ru:"Нет доступных файлов для воспроизведения с выбранным переводом",en:"No files available for playback with selected translation",uk:"Немає доступних файлів для відтворення з обраним перекладом",zh:"所选翻译没有可播放的文件"},skazfix_want_other:{ru:"Хотите выбрать другой?",en:"Do you want to choose another?",uk:"Хочете обрати інший?",zh:"您想选择另一个吗？"},skazfix_choose_other:{ru:"Выбрать другой",en:"Choose another",uk:"Обрати інший",zh:"选择另一个"},skazfix_choose_translation:{ru:"Выберите перевод",en:"Choose translation",uk:"Оберіть переклад",zh:"选择翻译"},skazfix_choose_stream:{ru:"Выберите поток",en:"Choose stream",uk:"Оберіть потік",zh:"选择流"},skazfix_stream:{ru:"Поток",en:"Stream",uk:"Потік",zh:"流"},skazfix_default:{ru:"Неизвестный перевод",en:"Unknown translation",uk:"Невідомий переклад",zh:"未知翻译"},skazfix_no_content:{ru:"К сожалению, не удалось найти видеоконтент для этого фильма. Попробуйте выбрать другой фильм или повторите попытку позже.",en:"Unfortunately, we couldn't find video content for this movie. Try selecting another movie or try again later.",uk:"На жаль, не вдалося знайти відеоконтент для цього фільму. Спробуйте обрати інший фільм або повторіть спробу пізніше.",zh:"很抱歉，我们找不到这部电影的视频内容。请尝试选择其他电影或稍后再试。"},skazfix_no_links:{ru:"Не удалось найти ссылок, выберите другой перевод",en:"Could not find links, choose another translation",uk:"Не вдалося знайти посилань, оберіть інший переклад",zh:"找不到链接，请选择其他翻译"},skazfix_online_title:{ru:"OnlySkaz 2.0",en:"OnlySkaz 2.0",uk:"OnlySkaz 2.0",zh:"OnlySkaz 2.0"},skazfix_always_show_choices:{ru:"Всегда выбирать озвучку и качество",en:"Always select voice and quality",uk:"Завжди вибирати озвучення і якість",zh:"总是选择配音和质量"},skazfix_always_show_choices_desc:{ru:"Всегда показывать выбор озвучки и потока",en:"Always show voice and stream selection",uk:"Завжди показувати вибір озвучення та потоку",zh:"始终显示配音和流选择"},skazfix_work_mode:{ru:"Режим работы",en:"Work mode",uk:"Режим роботи",zh:"工作模式"},skazfix_yes:{ru:"Да",en:"Yes",uk:"Так",zh:"是"},skazfix_no:{ru:"Нет",en:"No",uk:"Ні",zh:"否"},skazfix_online:{ru:"OnlySkaz 2.0",en:"OnlySkaz 2.0",uk:"OnlySkaz 2.0",zh:"OnlySkaz 2.0"},skazfix_close:{ru:"Закрыть",en:"Close",uk:"Закрити",zh:"关闭"},skazfix_action:{ru:"Действие",en:"Action",uk:"Дія",zh:"操作"},skazfix_mark:{ru:"Пометить",en:"Mark",uk:"Позначити",zh:"标记"},skazfix_unmark:{ru:"Снять отметку",en:"Unmark",uk:"Зняти позначку",zh:"取消标记"},skazfix_timeclear:{ru:"Сбросить тайм-код",en:"Reset timecode",uk:"Скинути тайм-код",zh:"重置时间码"},skazfix_clearallmark:{ru:"Очистить все метки",en:"Clear all marks",uk:"Очистити всі позначки",zh:"清除所有标记"},skazfix_clearalltime:{ru:"Очистить все тайм-коды",en:"Clear all timecodes",uk:"Очистити всі тайм-коди",zh:"清除所有时间码"},skazfix_more:{ru:"Ещё",en:"More",uk:"Ще",zh:"更多"},skazfix_sources_title:{ru:"Источники",en:"Sources",uk:"Джерела",zh:"源"},skazfix_choose_sources:{ru:"Выбор источников",en:"Choose sources",uk:"Вибір джерел",zh:"选择源"},skazfix_choose_balancers:{ru:"Выбрать балансеры для поиска",en:"Choose balancers for search",uk:"Обрати балансери для пошуку",zh:"选择搜索平衡器"},skazfix_reset_default:{ru:"Сбросить по умолчанию",en:"Reset to default",uk:"Скинути за замовчуванням",zh:"重置为默认"},skazfix_sources_reset:{ru:"Источники сброшены",en:"Sources reset",uk:"Джерела скинуто",zh:"源已重置"},skazfix_anime_title:{ru:"Аниме",en:"Anime",uk:"Аніме",zh:"动漫"},skazfix_remember_choices:{ru:"Запоминать озвучку, качество и балансер",en:"Remember voice, quality and balancer",uk:"Запам'ятовувати озвучення, якість і балансер",zh:"记住配音、质量和平衡器"},skazfix_remember_choices_desc:{ru:"Автоматически применять последний выбор при переключении серий",en:"Automatically apply last choice when switching episodes",uk:"Автоматично застосовувати останній вибір при перемиканні серій",zh:"切换剧集时自动应用上次选择"},skazfix_reset_remembered:{ru:"Сбросить сохранённую озвучку и качество",en:"Reset saved voice and quality",uk:"Скинути збережену озвучку та якість",zh:"重置保存的配音和质量"},skazfix_remembered_reset_done:{ru:"Сохранённая озвучка и качество сброшены",en:"Saved voice and quality have been reset",uk:"Збережену озвучку та якість скинуто",zh:"保存的配音和质量已重置"},skazfix_reset_section:{ru:"Сброс данных",en:"Reset data",uk:"Скидання даних",zh:"重置数据"},skazfix_clear_cache:{ru:"Очистить кеш серий",en:"Clear episodes cache",uk:"Очистити кеш серій",zh:"清除剧集缓存"},skazfix_cache_cleared:{ru:"Кеш серий очищен",en:"Episodes cache cleared",uk:"Кеш серій очищено",zh:"剧集缓存已清除"}});var c="http://",u="online_server_tokens",m="online_always_show_choices",f="online_selected_sources",d="online_selected_anime_sources",p="online_remember_choices",h="online_remembered_data",v=null,y='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" paint-order="stroke" stroke-opacity="100%" stroke="#fff" stroke-width="2" fill="currentColor"><path d="M 25 2 C 12.309288 2 2 12.309297 2 25 C 2 37.690703 12.309288 48 25 48 C 37.690712 48 48 37.690703 48 25 C 48 12.309297 37.690712 2 25 2 z M 25 4 C 36.609833 4 46 13.390175 46 25 C 46 36.609825 36.609833 46 25 46 C 13.390167 46 4 36.609825 4 25 C 4 13.390175 13.390167 4 25 4 z M 25 6.5 C 14.799 6.5 6.5 14.799 6.5 25 C 6.5 35.201 14.799 43.5 25 43.5 C 35.201 43.5 43.5 35.201 43.5 25 C 43.5 14.799 35.201 6.5 25 6.5 z M 24.757812 11.998047 C 30.071813 11.998047 33.514203 14.994953 34.283203 20.251953 L 30.080078 20.789062 C 30.080078 17.378062 28.162859 15.841797 24.755859 15.841797 C 21.970859 15.841797 18.994141 16.444969 18.994141 19.042969 C 18.994141 20.937969 20.6335 21.807875 26.3125 22.921875 C 30.3585 23.715875 35 25.297406 35 30.566406 C 35 34.158406 31.087719 38 25.261719 38 C 19.230719 38 15.569625 34.913828 14.640625 29.048828 L 18.892578 28.302734 C 18.892578 32.399734 21.118719 34.158203 25.261719 34.158203 C 28.808719 34.158203 31.174203 32.557406 31.158203 30.566406 C 31.143203 28.657406 30.003172 27.637547 25.576172 26.685547 C 20.946172 25.689547 15.152344 24.644969 15.152344 19.042969 C 15.152344 14.471969 20.102813 11.998047 24.757812 11.998047 z"></path></svg>',g=[{id:"rezka",name:"rezka",enabled:!1,clarification:1},{id:"rc/rhs",name:"rc/rhs",enabled:!1,clarification:1},{id:"rhsprem",name:"HDRezka",enabled:!0,clarification:1},{id:"kinopub",name:"kinopub",enabled:!0,clarification:1},{id:"vokino",name:"vokino",enabled:!1,clarification:1},{id:"mirage",name:"mirage",enabled:!1,clarification:1},{id:"alloha",name:"alloha",enabled:!0,clarification:1},{id:"rc/filmix",name:"rc/filmix",enabled:!1,clarification:1},{id:"rc/fxapi",name:"rc/fxapi",enabled:!1,clarification:1},{id:"fxapi",name:"fxapi",enabled:!1,clarification:1},{id:"filmix",name:"filmix",enabled:!0,clarification:1},{id:"filmixtv",name:"filmixtv",enabled:!1,clarification:1},{id:["videocdn","lumex"],name:"lumex",enabled:!1,clarification:1},{id:"kinogo",name:"kinogo",enabled:!1,clarification:1},{id:"vkmovie",name:"VK",enabled:!1,clarification:1},{id:"rutubemovie",name:"rutube",enabled:!1,clarification:1},{id:"videodb",name:"videodb",enabled:!1,clarification:1},{id:"collaps",name:"collaps",enabled:!1,clarification:1},{id:"collaps-dash",name:"collaps-dash",enabled:!1,clarification:1},{id:"hdvb",name:"hdvb",enabled:!1,clarification:1},{id:"zetflix",name:"zetflix",enabled:!1,clarification:1},{id:"veoveo",name:"veoveo",enabled:!1,clarification:1},{id:"kodik",name:"kodik",enabled:!0,clarification:0,anime:!0},{id:"ashdi",name:"ashdi",enabled:!1,clarification:1},{id:"kinoukr",name:"kinoukr",enabled:!1,clarification:1},{id:"kinotochka",name:"kinotochka",enabled:!1,clarification:1},{id:"remux",name:"remux",enabled:!1,clarification:1},{id:"iframevideo",name:"iframevideo",enabled:!1,clarification:1},{id:"cdnmovies",name:"cdnmovies",enabled:!1,clarification:1},{id:"anilibria",name:"anilibria",enabled:!1,clarification:1},{id:"animedia",name:"animedia",enabled:!1,clarification:1},{id:"animego",name:"animego",enabled:!1,clarification:1},{id:"animevost",name:"animevost",enabled:!1,clarification:1},{id:"animebesst",name:"animebesst",enabled:!1,clarification:1},{id:"redheadsound",name:"redheadsound",enabled:!1,clarification:1},{id:"animelib",name:"animelib",enabled:!1,clarification:1},{id:"moonanime",name:"moonanime",enabled:!1,clarification:1},{id:"vibix",name:"vibix",enabled:!1,clarification:1},{id:"vdbmovies",name:"vdbmovies",enabled:!1,clarification:1},{id:"fancdn",name:"fancdn",enabled:!1,clarification:1},{id:"cdnvideohub",name:"cdnvideohub",enabled:!1,clarification:1},{id:"vcdn",name:"vcdn",enabled:!1,clarification:1},{id:"hydraflix",name:"hydraflix",enabled:!1,clarification:1},{id:"videasy",name:"videasy",enabled:!1,clarification:1},{id:"vidsrc",name:"vidsrc",enabled:!1,clarification:1},{id:"movpi",name:"movpi",enabled:!1,clarification:1},{id:"vidlink",name:"vidlink",enabled:!1,clarification:1},{id:"twoembed",name:"twoembed",enabled:!1,clarification:1},{id:"autoembed",name:"autoembed",enabled:!1,clarification:1},{id:"smashystream",name:"smashystream",enabled:!1,clarification:1},{id:"rgshows",name:"rgshows",enabled:!1,clarification:1},{id:"pidtor",name:"pidtor",enabled:!1,clarification:1},{id:"videoseed",name:"videoseed",enabled:!1,clarification:1},{id:"iptvonline",name:"iptvonline",enabled:!1,clarification:1},{id:"eneyida",name:"eneyida",enabled:!1,clarification:1},{id:"kinobase",name:"kinobase",enabled:!1,clarification:1}];function _(){return g.filter((function(e){return e.enabled&&!e.anime})).map((function(e){return Lampa.Arrays.isArray(e.id)?e.id[0]:e.id}))}function k(){return g.filter((function(e){return e.enabled&&e.anime})).map((function(e){return Lampa.Arrays.isArray(e.id)?e.id[0]:e.id}))}function L(){var e=Lampa.Storage.get(f,[]);if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}Lampa.Arrays.isArray(e)&&0!==e.length||(e=_());var t=_();return 0===(e=e.filter((function(e){return-1!==t.indexOf(e)}))).length&&(e=_()),e}function b(e){Lampa.Storage.set(f,e)}function x(){var e=Lampa.Storage.get(d,[]);if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}Lampa.Arrays.isArray(e)&&0!==e.length||(e=k());var t=k();return 0===(e=e.filter((function(e){return-1!==t.indexOf(e)}))).length&&(e=k()),e}function S(e){Lampa.Storage.set(d,e)}function w(){var e=Lampa.Storage.get("skazonline_servers");return!0===e||"true"===e?["http://onlinecf3.skaz.tv/","http://onlinecf4.skaz.tv/","http://onlinecf5.skaz.tv/"]:["http://online3.skaz.tv/","http://online4.skaz.tv/","http://online5.skaz.tv/"]}var C=[],z="";function O(e){var t=w().filter((function(t){var a=t.replace(/\/+$/,"");return-1===e.indexOf(a)}));return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}function A(){if(z)return z;var e=O(C);if(e||(C=[],e=O([])),!e)return"";var t=e.replace(/\/+$/,"");return 0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&(t="http://"+t),z=t,t}function T(e){if(e){var t=e.replace(/\/+$/,"");-1===C.indexOf(t)&&C.push(t),z=""}}function P(){C=[],z=""}function q(){var e=w();return C.length<e.length}function E(){return Lampa.Storage.get(m,!1)}function F(e){Lampa.Storage.set(m,e)}function j(){return Lampa.Storage.get(p,!1)}function D(e){Lampa.Storage.set(p,e)}function V(){if(!v)return{};var e=Lampa.Storage.get(h,"{}");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}return(e=e||{})[v]||{}}function R(e){if(v){var t=Lampa.Storage.get(h,"{}");if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}(t=t||{})[v]=e,Lampa.Storage.set(h,t)}}function M(){return V().quality||""}function B(){return V().flowUrl||""}function N(){return V().sourceName||""}function I(){Lampa.Storage.set(h,"{}")}function U(e){return function(){var e=Lampa.Storage.get(u,"{}");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}return e||{}}()[e]||""}var G={get stream(){var e=A();return e?e.replace(/^https?:\/\//,""):""},get sources(){return L()},get anime(){return x()},nolite:[],filter_ts:["ts","тс","tс","тc","чистый звук"],filter_hr:["HDR10","HEVC"],filter_db:["Дубляж","Дублированный","Red Head Sound","Мосфильм","Dubляж"],filter_tv:[],filter_uk:["uk","ukr","укр"],filter_du:["Дубляж","Дублированный","Полное дублирование"],rename_translate:{HDRezka:["HDrezka Studio","RezkaStudio","Rezka Studio","Rezka"],StudioBand:["Студийная Банда","StudioBand","Studio Band"],"Дубляж":["Дубляж","Дублированный","Полное дублирование"],"Оригинал":["Не требуется","Оригинальный"],"Закадровый":["Многоголосый","Закадровый"]},filter_translate:s};function J(e,t){if(!e||!t)return!1;var a=e.toLowerCase().replace(/ /g,"").split(/\.|\[/)[0],n=t.toLowerCase().replace(/ /g,"").split(/\.|\[/)[0];return!(!a||!n)&&((a.length<=n.length?a:n).length<4?a===n:a.indexOf(n)>-1||n.indexOf(a)>-1)}function H(){var e=Lampa.Storage.get("region","{}");return e.code?e.code:"ru"}function K(e){return e.translate||e.name||e.details||e.title||""}function Q(e){return e.forEach((function(e){["translate","title","details","name"].forEach((function(t){if(e[t]){if(0===e[t].indexOf(Lampa.Lang.translate("skazfix_default")))return;if(/^\d{3,4}p$/i.test(e[t]))return void(e[t]=Lampa.Lang.translate("skazfix_default"));var a=e[t],n=!1,i=a.replace(/\s*\([^)]*\)\s*$/,"").trim();if(G.filter_translate.forEach((function(a){i.toLowerCase().indexOf(a.toLowerCase())>=0&&(e[t]=a,n=!0)})),!n){var r=function(a){G.rename_translate[a].forEach((function(r){i.toLowerCase()==r.toLowerCase()&&(e[t]=a,n=!0)}))};for(var o in G.rename_translate)r(o)}if(n||G.filter_du.forEach((function(a){i.toLowerCase().indexOf(a.toLowerCase())>=0&&(e[t]=a,n=!0)})),!n){var l=(s=/\(([^()]+)\)$/,c=1,(m=(u=a).match(s))&&m[c]?m[c]:u);l!==a&&G.filter_translate.forEach((function(a){l.toLowerCase().indexOf(a.toLowerCase())>=0&&(e[t]=a,n=!0)}))}n||(i.length>0?e[t]=i:e[t]=Lampa.Lang.translate("skazfix_default"))}var s,c,u,m}))})),e}var W={compareVoice:J,region:H,voice:K,player:function(){return Lampa.Platform.is("tizen")||Lampa.Platform.is("webos")?"inner":Lampa.Storage.field("player")},filterTranslate:function(e){if(!e||!Lampa.Arrays.isArray(e)||0===e.length)return[];var t=e.filter((function(e){return 0==G.filter_hr.filter((function(t){return K(e).toLowerCase().indexOf(t.toLowerCase())>=0})).length}));return t=t.filter((function(e){return 0==G.filter_ts.filter((function(t){return K(e).toLowerCase().indexOf(" "+t.toLowerCase())>=0})).length})),"ru"==H()&&(t=t.filter((function(e){return 0==G.filter_uk.filter((function(t){return K(e).toLowerCase().indexOf(t.toLowerCase())>=0})).length}))),Q(t),t},renameTranslate:Q,sortDUBTranstale:function(e){e.sort((function(e,t){var a=G.filter_db.filter((function(t){return K(e).toLowerCase().indexOf(t.toLowerCase())>=0})).length,n=G.filter_db.filter((function(e){return K(t).toLowerCase().indexOf(e.toLowerCase())>=0})).length;return a&&!n?-1:!a&&n?1:0}))},modalChoiceTranstale:function(e,t){var a=Lampa.Controller.enabled().name,n=$('<div class="connect-broken">\n\t\t\t\t\t\t<div class="connect-broken__title">'.concat(Lampa.Lang.translate("skazfix_error_title"),'</div>\n\t\t\t\t\t\t<div class="connect-broken__text">').concat(Lampa.Lang.translate("skazfix_no_files")," (<b>").concat(e.from,"</b>). ").concat(Lampa.Lang.translate("skazfix_want_other"),'</div>\n\t\t\t\t\t\t<div class="connect-broken__footer">\n\t\t\t\t\t\t\t<div class="selector simple-button next">').concat(Lampa.Lang.translate("skazfix_choose_other"),"</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"));n.find(".selector").on("hover:enter",(function(){Lampa.Modal.close(),Lampa.Controller.toggle(a)})),n.find(".next").on("hover:enter",(function(){Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_translation"),items:e.voicelist,onBack:function(){Lampa.Controller.toggle(a),t&&t()}})})),Lampa.Modal.open({title:"",html:n,onBack:function(){Lampa.Modal.close(),Lampa.Controller.toggle(a),t&&t()}})},selectChoiceTranstale:function(e,t,a){var n={};if(e.forEach((function(e){var t=K(e).replace(/\.Subtitles$/i,"");n[t]||(n[t]={items:[],sources:[],maxquality:0}),n[t].items.push(e);var a=e.source_name||"";a&&-1===n[t].sources.indexOf(a)&&n[t].sources.push(a);var i=parseInt(e.maxquality)||0;i>n[t].maxquality&&(n[t].maxquality=i)})),j()){var i=V().voice||"";M(),N(),B();if(i)for(var r in n)if(J(r,i)){var o=n[r].items[0];return void a(o)}}var l=[];for(var s in n){var c=n[s],u=[];c.sources.length>0&&u.push(c.sources.join(", ")),c.maxquality>0&&u.push(c.maxquality+"p"),l.push({title:s,subtitle:u.join(" • "),selected:J(s,t),voiceItems:c.items,onSelect:function(){var e,t;j()&&(e=this.title,(t=V()).voice=e,R(t)),Lampa.Controller.toggle("content"),a(this.voiceItems[0])}})}Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_translation"),items:l,onBack:function(){Lampa.Controller.toggle("content")}})},selectChoiceFlow:function(e,t){if(j()){var a=M(),n=N(),i=B();if(a||n||i){var r=null;if(i&&(r=e.find((function(e){return e.url===i}))),!r&&n&&a&&(r=e.find((function(e){return e.quality==a&&e.source_name===n}))),!r&&a&&(r=e.find((function(e){return e.quality==a}))),r)return void t(r)}}Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_stream"),items:e.map((function(e){return{title:e.quality+(e.label?"<sub>"+e.label+"</sub>":""),selected:e.selected,subtitle:e.source_name?e.source_name+" | "+Lampa.Utils.shortText(e.url,35):Lampa.Utils.shortText(e.url,35),onSelect:function(){var a,n,i,r;j()&&(a=e.quality,n=e.url,i=e.source_name,(r=V()).quality=a,r.flowUrl=n,r.sourceName=i||"",R(r)),Lampa.Controller.toggle("content"),t(e)}}})),onBack:function(){Lampa.Controller.toggle("content")}})}};function X(e){if(-1==(e+="").indexOf("uid=")){var t=Lampa.Storage.get("lampac_unic_id","")||"guest";e=Lampa.Utils.addUrlComponent(e,"uid="+encodeURIComponent(t))}if(-1==e.indexOf("account_email=")){var a=Lampa.Storage.get("account_email","");a&&(e=Lampa.Utils.addUrlComponent(e,"account_email="+encodeURIComponent(a)))}-1==e.indexOf("rchtype=")&&(e=Lampa.Utils.addUrlComponent(e,"rchtype=web"));var n=function(){var e=A();if(!e)return"";var t=e.replace(/^https?:\/\//,"").replace(/\/+$/,"");return U(e)||U(e.replace(/\/+$/,""))||U(t)||""}();if(n){var i=n.split("=")[0];i&&-1==e.indexOf(i+"=")&&(e=Lampa.Utils.addUrlComponent(e,n))}return e}var Z={},Y=function(){function a(e){t(this,a),this.object=e,this.network=new Lampa.Reguest,this.voiceSave=new r(e),this.memkey=null,this.lifeChecked=!1,this._voiceCache={}}return n(a,[{key:"externalids",value:function(){var e=this;return new Promise((function(t,a){if(e.object.movie.imdb_id&&e.object.movie.kinopoisk_id)t();else{var n=[];n.push("id="+e.object.movie.id),n.push("serial="+(e.object.movie.name?1:0)),e.object.movie.imdb_id&&n.push("imdb_id="+(e.object.movie.imdb_id||"")),e.object.movie.kinopoisk_id&&n.push("kinopoisk_id="+(e.object.movie.kinopoisk_id||""));var i=c+G.stream+"/externalids?"+n.join("&");e.network.timeout(1e4),e.network.silent(X(i),(function(a){for(var n in a)e.object.movie[n]=a[n];t()}),(function(){t()}))}}))}},{key:"requestParams",value:function(e){var t=[],a=this.object,n=a.movie.source||"tmdb";return t.push("id="+a.movie.id),a.movie.imdb_id&&t.push("imdb_id="+(a.movie.imdb_id||"")),a.movie.kinopoisk_id&&t.push("kinopoisk_id="+(a.movie.kinopoisk_id||"")),t.push("title="+encodeURIComponent(a.clarification?a.search:a.movie.title||a.movie.name)),t.push("original_title="+encodeURIComponent(a.movie.original_title||a.movie.original_name)),t.push("serial="+(a.movie.name?1:0)),t.push("original_language="+(a.movie.original_language||"")),t.push("year="+((a.movie.release_date||a.movie.first_air_date||"0000")+"").slice(0,4)),t.push("source="+n),t.push("clarification="+(a.clarification?1:0)),Lampa.Storage.get("account_email","")&&t.push("cub_id="+Lampa.Utils.hash(Lampa.Storage.get("account_email",""))),e+(e.indexOf("?")>=0?"&":"?")+t.join("&")}},{key:"query",value:function(e){var t=this;return new Promise((function(a,n){var i=[].concat(G.sources);e.movie&&e.movie.original_language&&["ja","ko","zh","cn"].find((function(t){return e.movie.original_language.toLowerCase()==t}))&&(i=i.concat(G.anime));var r,l=new o(i.length),s=!1;function c(){s||Lampa.Noty.show(Lampa.Lang.translate("skazfix_wait"))}c(),r=setInterval(c,2e3),l.onComplite=function(e){s=!0,clearInterval(r);var t=[],o=700;i.forEach((function(a){var n=e[a];if(n)if(n.error)o=n.error;else if(n.accsdb)o=600;else if("similar"!=n.type&&n.data&&0!==n.data.length){var i=n.balanser||n._source_id||a;n.voice&&Lampa.Arrays.isArray(n.voice)&&n.voice.forEach((function(e){e.source_name=i})),n.data&&Lampa.Arrays.isArray(n.data)&&n.data.forEach((function(e){e.source_name=i})),n.source_name=i,t.push(n.voice?n:n.data)}})),t.length?a(t):n(o)},i.forEach((function(a){t.source(a,e.season).then((function(e){if(e.voice&&e.data&&e.data[0]&&e.data[0].quality){var t=0;for(var n in e.data[0].quality){var i=parseInt(n);i>t&&(t=i)}t>0&&e.voice.forEach((function(e){(!e.maxquality||parseInt(e.maxquality)<t)&&(e.maxquality=t+"p")}))}e._source_id=a,l.append(a,e)})).catch((function(e){l.append(a,{error:e})}))}))}))}},{key:"checkLife",value:function(){var e=this;return new Promise((function(t,a){if(e.lifeChecked)t();else{var n=c+G.stream+"/lite/events?life=true",i=e.requestParams(X(n));-1!==(i=i.replace("rjson=true&","").replace("&rjson=true","").replace("rjson=true","")).indexOf("clarification=0")&&(i=i.replace("clarification=0","clarification=1")),-1===i.indexOf("similar=")&&(i=Lampa.Utils.addUrlComponent(i,"similar=false")),e.network.timeout(1e4),e.network.silent(i,(function(a){var n;try{n="string"==typeof a?JSON.parse(a):a}catch(e){}e.lifeChecked=!0,n&&n.life&&n.memkey&&(e.memkey=n.memkey),t()}),(function(){e.lifeChecked=!0,t()}),!1,{dataType:"text"})}}))}},{key:"parseJsonResponse",value:function(e){var t={voice:[],data:[]};return e&&e.data&&Lampa.Arrays.isArray(e.data)?(e.data.forEach((function(e){e.stream?(t.data.push({method:"play",url:e.stream,quality:{auto:e.stream},translate:e.translate||"",maxquality:e.maxquality||"",title:e.title||"",voice_name:e.translate||e.voice_name||""}),t.voice.push({name:e.translate||e.voice_name||"",maxquality:e.maxquality||"",method:"play",url:e.stream})):"play"===e.method&&e.url?(t.data.push({method:"play",url:e.url,quality:e.quality||{auto:e.url},translate:e.translate||"",maxquality:e.maxquality||"",title:e.title||"",voice_name:e.translate||e.voice_name||""}),t.voice.push({name:e.translate||e.voice_name||"",maxquality:e.maxquality||"",method:"play",url:e.url,quality:e.quality})):"call"===e.method&&e.url&&(t.data.push(e),t.voice.push({name:e.translate||e.voice_name||"",maxquality:e.maxquality||"",method:"call",url:e.url}))})),t.type=e.type,t):t}},{key:"source",value:function(e,t){var a=this;return new Promise((function(n,i){a.checkLife().then((function(){var r=function(e){for(var t=0;t<g.length;t++){var a=g[t],n=Lampa.Arrays.isArray(a.id)?a.id:[a.id];if(-1!==n.indexOf(e))return n}return[e]}(e),o=0,l=function(){if(o>=r.length)i(400);else{var e=r[o],s=function(r,u){var m=r?"/lite/":"/",f=c+G.stream+m+e,d=a.requestParams(X(f));d=Lampa.Utils.addUrlComponent(d,"rjson=true");var p=function(e){for(var t=0;t<g.length;t++){var a=g[t];if(-1!==(Lampa.Arrays.isArray(a.id)?a.id:[a.id]).indexOf(e))return void 0!==a.clarification?a.clarification:1}return 1}(e);1===p&&-1!==d.indexOf("clarification=0")?d=d.replace("clarification=0","clarification=1"):0===p&&-1!==d.indexOf("clarification=1")&&(d=d.replace("clarification=1","clarification=0")),-1===d.indexOf("similar=")&&(d=Lampa.Utils.addUrlComponent(d,"similar=false")),t&&(d+="&s="+t),a.network.timeout(1e4),a.network.silent(d,(function(e){var t;try{t="string"==typeof e?JSON.parse(e):e}catch(e){}t&&t.data&&!t.voice&&(t=a.parseJsonResponse(t)),t?"disable"===t||t.disable||t.error&&!t.data?(o++,l()):n(t):"disable"===e?(o++,l()):i(500)}),(function(){r?s(!1,u):(o++,l())}),!1,{})},u=-1==G.nolite.indexOf(e);s(u,!1)}};l()}))}))}},{key:"links",value:function(e){return new Promise((function(t,a){var n=[],i=[];e.forEach((function(e){n=n.concat(e.filter((function(e){return"call"==e.method}))),i=i.concat(e.filter((function(e){return"play"==e.method})))})),worker.onComplite=function(){t(W.renameTranslate(i))},worker.process=function(e){var t="links_"+e.source_name+"_"+e.e;if(Z[t]){var a=Z[t],n=JSON.parse(JSON.stringify(a));return n.details=e.details||n.details||"no details",n.translate=e.translate||n.translate||"no translate",n.source_name=e.source_name,i.push(n),void worker.next()}var r=new Lampa.Reguest,o=X(e.url);r.timeout(1e4),r.silent(o,(function(a){var n=a;if("string"==typeof n)try{n=JSON.parse(n)}catch(e){n={}}if(!n.quality&&n.url){n.quality={};var r=n.url;-1!==r.indexOf(" or ")&&(r=r.split(" or ")[0]),n.quality.auto=n.url}n.quality&&Object.keys(n.quality).length>0&&(Z[t]=JSON.parse(JSON.stringify(n)),n.details=e.details||n.details||"no details",n.translate=e.translate||n.translate||"no translate",n.source_name=e.source_name,i.push(n)),worker.next()}),(function(e){worker.error()}),!1,{dataType:"text"})},n.forEach((function(e){processCall(e,!1)})),0==n.length&&t(W.renameTranslate(i))}))}},{key:"m3u",value:function(e){var t=this;return new Promise((function(a,n){var i=[],r=Lampa.Storage.field("video_quality_default"),o=function(t){parseInt(t)<=r&&[e.quality[t].url].concat(e.quality[t].reserve).forEach((function(a){i.push({quality:t,name:e.name,url:a})}))};for(var l in e.quality)o(l);t.network.silent(c+G.stream+"/m3u/add",(function(e){a(c+G.stream+e.url)}),(function(e,t){n(400)}),{playlist:i})}))}},{key:"flows",value:function(e){var t=[],a=Lampa.Storage.field("video_quality_default"),n={},i=function(a){var i=[e[a].url].concat(e[a].reserve),r=parseInt(a),o=e[a].urlSources||{};i.forEach((function(e){n[e]||(n[e]=!0,t.push({int:r,label:r>1440?"4K":r>=1440?"2K":r>=1080?"FHD":r>=720?"HD":"",quality:a,url:e,source_name:o[e]||""}))}))};for(var r in e)i(r);var o=t.find((function(e){return e.int==a}));return o&&(o.selected=!0),t}},{key:"movie",value:function(e){var t=this;return new Promise((function(a,n){t.externalids().then((function(){return t.query(e)})).then((function(e){var i=[];e.forEach((function(e){var t=e.voice?e.voice:Lampa.Arrays.isArray(e)?e:[],a=W.filterTranslate(t);a.length&&(a.forEach((function(t){if(e.data&&Lampa.Arrays.isArray(e.data)){var a=e.data.find((function(e){return e.translate===t.name||e.voice_name===t.name||e.url===t.url}));a&&(t.quality=a.quality,t.url=a.url,t.method=a.method)}t.source_name=e.source_name||t.source_name})),i=i.concat(a))}));new Promise((function(e){var a=i.filter((function(e){return"call"==e.method}));if(0!=a.length){var n=new o(a.length),r=[];n.onComplite=function(){i=i.filter((function(e){return"call"!=e.method||-1!==r.indexOf(e)})),e()},a.forEach((function(e){var a;a=e.url,t.network.timeout(-1!==(e.source_name||"").toLowerCase().indexOf("mirage")?1e4:5e3),t.network.silent(X(a),(function(t){var a=t;a&&(a.url||a.quality&&Object.keys(a.quality).length>0)&&r.push(e),n.next()}),(function(){n.next()}))}))}else e()})).then((function(){if(i.forEach((function(e){e.maxquality=e.maxquality||"1080p",e.translate=e.translate||e.name||"";var t=e.translate.match(/\[(.*?)\]/);t&&(t=t[1].split(",").map((function(e){return e.trim()})),e.lang=(t.map((function(e){return e.toLowerCase()})).find((function(e){return"ru"==e||"uk"==e||"rus"==e||"ukr"==e||"укр"==e}))||"").toUpperCase(),e.lang="RUS"==e.lang?"RU":"UKR"==e.lang?"UA":e.lang,"RU"==e.lang&&"ru"==W.region()&&(e.lang=""),e.translate=t.find((function(e){return e.length>5}))||e.translate)})),0==i.length)throw new Error("No data");W.renameTranslate(i),a({sources:e,translates:i})})).catch((function(e){n(e)}))})).catch(n)}))}},{key:"tv",value:function(t){var a=this;return new Promise((function(n,r){a.externalids().then((function(){a.query(t).then((function(t){a.voice(t).then((function(a){n(function(t){for(var a=1;a<arguments.length;a++){var n,r=null!==(n=arguments[a])&&void 0!==n?n:{};a%2?e(Object(r),!0).forEach((function(e){i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({sources:t},a))})).catch(r)})).catch(r)}))}))}},{key:"voice",value:function(e){var t=this;return new Promise((function(a,n){var i=t.voiceSave.get();if(t._voiceCache[i])a(t._voiceCache[i]);else{var r=[],l=G.filter_tv,s=[],c=function(e,t){e.data.forEach((function(e){e.translate_name=t}))},u=function(e,t){return new Promise((function(t,a){var n=new Lampa.Reguest;n.timeout(1e4),n.silent(X(e.url),(function(i){var r,o=i;if("string"==typeof i)if(-1!==i.indexOf("<div")||-1!==i.indexOf("data-json"))r={data:[]},$(i).find("[data-json]").each((function(){try{var e=$(this).attr("data-json"),t=JSON.parse(e);"play"===t.method&&t.url&&r.data.push(t)}catch(e){}})),o=r;else try{o=JSON.parse(i)}catch(e){o={}}if(o.data&&0!==o.data.length){if(o.data.every((function(e){return"link"===e.method}))&&o.data.length>0){var l=o.data[0];return n.timeout(1e4),void n.silent(X(l.url),(function(i){var r=i;if("string"==typeof i)try{r=JSON.parse(i)}catch(e){r={}}if(r.data&&0!==r.data.length){if(c(r,W.voice(e)),r.data.every((function(e){return"call"===e.method}))&&r.data.length>0){if("kodik"===(e.source_name||"").toLowerCase())return void t(r.data);var o=r.data[0];return n.timeout(5e3),void n.silent(X(o.url),(function(e){var a=e;if("string"==typeof e)try{a=JSON.parse(e)}catch(e){a={}}a.quality&&Object.keys(a.quality).length>0&&r.data.forEach((function(e){e.quality=a.quality,e.details=a.details||e.details,e.translate=a.translate||e.translate,e.method="play"})),t(r.data)}),(function(){t(r.data)}),!1,{dataType:"text"})}t(r.data)}else a("no episodes in season")}),(function(e){a("season link network error")}),!1,{dataType:"text"})}if(o.data.every((function(e){return"call"===e.method}))&&o.data.length>0)if("kodik"===(e.source_name||"").toLowerCase())c(o,W.voice(e)),t(o.data);else{var s=o.data[0];n.timeout(-1!==(e.source_name||"").toLowerCase().indexOf("mirage")?1e4:5e3),n.silent(X(s.url),(function(n){var i=n;if("string"==typeof n)try{i=JSON.parse(n)}catch(e){i={}}i.quality&&0!==Object.keys(i.quality).length?(c(o,W.voice(e)),o.data.forEach((function(e){e.quality=i.quality,e.details=i.details||e.details,e.translate=i.translate||e.translate,e.method="play"})),t(o.data)):a("no quality in call")}),(function(a){c(o,W.voice(e)),t(o.data)}),!1,{dataType:"text"})}else c(o,W.voice(e)),t(o.data)}else a("no data")}),(function(e){a(e)}),!1,{dataType:"text"})}))},m=[];e.forEach((function(e){e.source_name||e.balanser;if(e.voice&&Lampa.Arrays.isArray(e.voice)){if(e.data&&Lampa.Arrays.isArray(e.data))if(e.data.some((function(e){return"play"===e.method&&e.url}))){var t=e.voice.find((function(e){return!0===e.active}))||e.voice[0],a=t&&t.name||"";e.data.forEach((function(t){"play"===t.method&&(t.translate_name=a,t.source_name=e.source_name||e.balanser||"",m.push(t))}))}e.voice=W.filterTranslate(e.voice);var n=e.source_name||e.balanser||"";e.voice.forEach((function(e){e.source_name=e.source_name||n})),s=s.concat(e.voice.filter((function(e){return 0==l.filter((function(t){return W.voice(e).toLowerCase().indexOf(t)>=0})).length})))}})),i||(i=W.voice(s[0])),s.sort((function(e,t){return W.voice(e).toLowerCase().localeCompare(W.voice(t).toLowerCase())}));var f=s;if(0!==f.length){var d=f.filter((function(e){return W.compareVoice(e.name,i)}));0===d.length&&(d=[f[0]]),r=m.filter((function(e){return W.compareVoice(e.translate_name,i)}));var p=new o(d.length);p.onComplite=function(){t._voiceCache[i]=r;var e={translates:f,plays:r};t._voiceCache[i]=e,a(e)},d.forEach((function(e){u(e).then((function(t){var a=e.source_name||"";a&&t.forEach((function(e){e.source_name||(e.source_name=a)})),r=r.concat(t),p.next()})).catch((function(e){p.next()}))}))}else n(700)}}))}},{key:"error",value:function(e){var t=Lampa.Controller.enabled().name,a=Lampa.Lang.translate("skazfix_no_content"),n=$('<div class="connect-broken">\n\t\t\t\t\t\t\t\t\t<div class="connect-broken__title">'.concat(Lampa.Lang.translate("skazfix_error_title"),'</div>\n\t\t\t\t\t\t\t\t\t<div class="connect-broken__text">').concat(a,'</div>\n\t\t\t\t\t\t\t\t\t<div class="connect-broken__footer">\n\t\t\t\t\t\t\t\t\t\t<div class="selector simple-button">').concat(Lampa.Lang.translate("skazfix_close"),"</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>"));n.find(".selector").on("hover:enter",(function(){Lampa.Controller.back()})),Lampa.Modal.open({title:"",html:n,onBack:function(){Lampa.Modal.close(),Lampa.Controller.toggle(t)}})}}]),a}();function ee(e,t){var a=0,n=0;e.forEach((function(e,t){!e.quality&&e.url&&-1!==e.url.indexOf(".m3u8")&&a++})),0!==a?e.forEach((function(i,r){if(!i.quality&&i.url&&-1!==i.url.indexOf(".m3u8")){var o=new Lampa.Reguest;o.timeout(5e3),o.native(i.url,(function(r){if("string"==typeof r&&-1!==r.indexOf("#EXT-X-STREAM-INF")){var o=function(e,t){for(var a={},n=e.split("\n"),i=null,r=0;r<n.length;r++){var o=n[r].trim();if(0===o.indexOf("#EXT-X-STREAM-INF")){var l=o.match(/RESOLUTION=(\d+)x(\d+)/i);if(l)i=parseInt(l[2]);else{var s=o.match(/BANDWIDTH=(\d+)/i);if(s){var c=parseInt(s[1]);i=c>4e6?1080:c>2e6?720:c>1e6?480:c>5e5?360:240}}}else if(i&&o&&0!==o.indexOf("#")){var u=o;if(0!==u.indexOf("http")){var m=t.split("/");m.pop(),u=m.join("/")+"/"+u}var f=i+"p";a[f]||(a[f]=u),i=null}}return a}(r,i.url);Object.keys(o).length>0&&(i.quality=o)}++n>=a&&t(e)}),(function(){++n>=a&&t(e)}),!1,{dataType:"text"})}})):t(e)}var te=function(){function e(a){var n=this;t(this,e),this.object=a,this.extract=new Y(a),this.voice=new r(a),this.on_error_timer=null;Lampa.Player.listener.follow("destroy",(function e(){Lampa.Player.listener.remove("destroy",e),clearTimeout(n.on_error_timer)}))}return n(e,[{key:"getQuality",value:function(e){var t=this,a={},n={};e.forEach((function(e,i){var r=e.quality,o=e.source_name||"";if(!r||"object"!==_typeof(r)){if(!e.url)return;r={auto:e.url}}var l=function(e){var i=parseInt(e),l=t.getSplitLinks(r[e]);l.forEach((function(e){o&&!n[e]&&(n[e]=o)})),a[e]?(a[e].reserve=a[e].reserve.concat(l),a[e].urlSources=n):a[e]={label:i>1440?"4K":i>=1440?"2K":i>=1080?"FHD":i>=720?"HD":"",url:l[0],reserve:l.length>1?l.slice(1):[],used:[],error:[],urlSources:n,trigger:function(){t.setFlowsForQuality(Lampa.Player.playdata())}}};for(var s in r)l(s)}));var i=Lampa.Arrays.getKeys(a),r={};return i.sort((function(e,t){var a=parseInt((e+"").replace(/[^0-9]/g,""))||0,n=parseInt((t+"").replace(/[^0-9]/g,""))||0;return 0===a&&0===n?(e+"").localeCompare(t+""):0===a?1:0===n?-1:n-a})),i.forEach((function(e){var t=parseInt((e+"").replace(/[^0-9]/g,""))||0;t>0&&!a[e].label&&(a[e].label=t>1440?"4K":t>=1440?"2K":t>=1080?"FHD":t>=720?"HD":""),r[e]=a[e]})),r}},{key:"getSplitLinks",value:function(e){if("string"!=typeof e)return e&&e.url?[e.url]:[String(e)];var t=e.split(" or "),a=[];return t.forEach((function(e){-1===a.indexOf(e)&&a.push(e)})),a}},{key:"getSelectedQuality",value:function(e){var t=null,a=e.url,n=e.quality;if(e.quality_switched){for(var i in n)if(i==e.quality_switched){t=n[i];break}}else for(var i in n){var r=n[i];if(r.url==a||r.reserve.indexOf(a)>=0){t=r;break}}if(!t)for(var i in n){t=n[i];break}return t}},{key:"getQualityLevelDown",value:function(e){var t,a,n=this.getSelectedQuality(e);for(var i in e.quality)if(n==e.quality[i]){t=i;break}if(t){var r=Lampa.Arrays.getKeys(e.quality);r.sort((function(e,t){return parseInt(t)-parseInt(e)})),r.forEach((function(e){parseInt(e)<parseInt(t)&&!a&&(a=e)}))}return a}},{key:"getReserveQuality",value:function(e){var t=this.getSelectedQuality(e),a="";return t&&(t.error.push(Lampa.Manifest.app_digital>=236?e.url:t.url),t.reserve.forEach((function(e){-1!=t.used.indexOf(e)||a||(a=e,t.used.push(e))}))),a}},{key:"getPlayData",value:function(e){var t=Lampa.Utils.hash(e.season?[e.season,e.season>10?":":"",e.episode,this.object.movie.original_title].join(""):this.object.movie.original_title),a=this.getQuality(e.quality);return{title:this.object.movie.title||this.object.movie.name,url:Lampa.Player.getUrlQuality(a),quality:a,timeline:Lampa.Timeline.view(t),translate_name:e.translate,card:this.object.movie}}},{key:"getNextVoice",value:function(e,t,a){var n=this.getSelectedQuality(e);if(n&&(0==n.reserve.length||n.used.length==n.reserve.length)){var i=this.getQualityLevelDown(e);i?(e.quality_switched=i,n=this.getSelectedQuality(e),Lampa.Arrays.remove(n.reserve,n.url),Lampa.Arrays.insert(n.reserve,0,n.url)):n=null}n?(e.url=this.getReserveQuality(e),a(e.url||"nofound"),this.setFlowsForQuality(e)):W.modalChoiceTranstale({from:t.find((function(e){return e.selected})).name,voicelist:t})}},{key:"setFlowsForQuality",value:function(e){if(e&&e.quality){var t=Object.keys(e.quality);if(1!==t.length||"auto"!==t[0]){var a=this.getSelectedQuality(e);if(a){s=[];var n=[a.url].concat(a.reserve.filter((function(e){return e!==a.url}))).filter((function(e){return-1==a.error.indexOf(e)}));n.length>0&&n.forEach((function(e,t){var n=a.urlSources&&a.urlSources[e]?a.urlSources[e]:"",i=n||Lampa.Utils.shortText(e,35);s.push({title:Lampa.Lang.translate("skazfix_stream")+" "+(t+1),subtitle:i,url:e,selected:e==a.url})})),Lampa.PlayerPanel.setFlows(!!s.length&&s)}}else{var i=e.quality.auto,r=i.url||i;if("string"==typeof r&&r){var o=i.urlSources&&i.urlSources[r]?i.urlSources[r]:"",l=o||Lampa.Utils.shortText(r,35),s=[{title:Lampa.Lang.translate("skazfix_stream")+" 1",subtitle:l,url:r,selected:!0}];Lampa.PlayerPanel.setFlows(s)}}}}},{key:"movie",value:function(e){var t=this,a=W.player(),n=E()||"inner"!=a;e.translates.sort((function(e,t){var a=parseInt(e.maxquality)||0,n=parseInt(t.maxquality)||0;if(n!==a)return n-a;var i=G.filter_db.filter((function(t){return e.translate.toLowerCase().indexOf(t.toLowerCase())>=0})).length,r=G.filter_db.filter((function(e){return t.translate.toLowerCase().indexOf(e.toLowerCase())>=0})).length;return i&&!r?-1:!i&&r?1:0}));var i=this.voice.get();i||(i=W.voice(e.translates[0]));var r=e.translates.filter((function(e){return W.compareVoice(W.voice(e),i)})),o=Lampa.Utils.hash(this.object.movie.original_title);if(n){var l={};e.translates.forEach((function(e){var t=W.voice(e);l[t]||(l[t]=[]),l[t].push(e)}));var s=Object.keys(l),c={},u=0;s.forEach((function(e){t.extract.links([l[e]]).then((function(a){if(a.length>0&&(c[e]=l[e]),++u===s.length){var n=[];for(var r in c)n=n.concat(c[r]);if(0===n.length)return t.extract.error(700);W.selectChoiceTranstale(n,i,(function(e){t.voice.set(W.voice(e)),t.extract.links([n.filter((function(t){return W.compareVoice(W.voice(t),W.voice(e))}))]).then((function(e){if(0==e.length)return Lampa.Bell.push({text:Lampa.Lang.translate("skazfix_no_links"),time:5e3});var a=t.getQuality(e),n=e.find((function(e){return e.subtitles})),i=t.extract.flows(a);W.selectChoiceFlow(i,(function(e){var a={title:t.object.movie.title||t.object.movie.name,url:e.url,timeline:Lampa.Timeline.view(o),subtitles:!!n&&n.subtitles};Lampa.Player.play(a)}))})).catch((function(e){t.extract.error(e)}))}))}})).catch((function(e){if(++u===s.length){var a=[];for(var n in c)a=a.concat(c[n]);if(0===a.length)return t.extract.error(700);W.selectChoiceTranstale(a,i,(function(e){t.voice.set(W.voice(e)),t.extract.links([a.filter((function(t){return W.compareVoice(W.voice(t),W.voice(e))}))]).then((function(e){if(0==e.length)return Lampa.Bell.push({text:Lampa.Lang.translate("skazfix_no_links"),time:5e3});var a=t.getQuality(e),n=e.find((function(e){return e.subtitles})),i=t.extract.flows(a);W.selectChoiceFlow(i,(function(e){var a={title:t.object.movie.title||t.object.movie.name,url:e.url,timeline:Lampa.Timeline.view(o),subtitles:!!n&&n.subtitles};Lampa.Player.play(a)}))})).catch((function(e){t.extract.error(e)}))}))}}))}))}else"inner"==a&&t.extract.links([r]).then((function(a){ee(a,(function(a){Lampa.Player.opened()&&Lampa.Player.close();var n=[],l=t.getQuality(a),s=a.find((function(e){return e.subtitles})),c={};a.forEach((function(e){var t=e.translate_name||e.translate||"",a=e.source_name||"";t&&a&&(c[t]||(c[t]=[]),-1===c[t].indexOf(a)&&c[t].push(a))}));var u={};r.forEach((function(e){var t=e.translate,a=e.source_name||"";u[t]||(u[t]=[]),a&&-1===u[t].indexOf(a)&&u[t].push(a)}));var m={};for(var f in e.translates.forEach((function(e){var t=e.translate;m[t]||(m[t]={item:e,sources:[],maxquality:0});var a=e.source_name||"",n=!1;a&&-1===m[t].sources.indexOf(a)&&(W.compareVoice(t,i)?c[t]&&-1!==c[t].indexOf(a)&&(n=!0):n=!0),n&&m[t].sources.push(a);var r=parseInt(e.maxquality)||0;r>m[t].maxquality&&(m[t].maxquality=r)})),m){var d=m[f],p=(d.item,[]);d.sources.length>0&&p.push(d.sources.join(", ")),d.maxquality>0&&p.push(d.maxquality+"p"),n.push({selected:W.compareVoice(i,f),name:f,title:f,subtitle:p.join(" • "),onSelect:function(){t.voice.set(this.name),Lampa.Player.loading(!0),t.movie(e)}})}n.length>0&&!n.find((function(e){return e.selected}))&&(n[0].selected=!0);var h={title:t.object.movie.title||t.object.movie.name,url:a.length?Lampa.Player.getUrlQuality(l):"nofound",quality:l,timeline:Lampa.Timeline.view(o),subtitles:!!s&&s.subtitles,card:t.object.movie,voiceovers:n,error:function(e,a){t.on_error_timer=setTimeout((function(){t.getNextVoice(e,n,a)}),2e3)}};Lampa.Player.runas("inner"),Lampa.Player.play(h),Lampa.Player.playlist([]),t.setFlowsForQuality(h)}))}))}},{key:"tv",value:function(e,t,a){var n=this,i=[],r=[],o=this.voice.get();Lampa.Controller.toggle("content"),W.sortDUBTranstale(e.translates);var l={};for(var s in e.translates.forEach((function(e){var t=e.name;l[t]||(l[t]={item:e,sources:[],maxquality:0});var a=e.source_name||"";a&&-1===l[t].sources.indexOf(a)&&l[t].sources.push(a);var n=parseInt(e.maxquality)||0;n>l[t].maxquality&&(l[t].maxquality=n)})),l){var c=l[s];c.item;!function(i,l,s){var c=[];l.sources.length>0&&c.push(l.sources.join(", ")),l.maxquality>0&&c.push(l.maxquality+"p"),r.push({name:i,title:i,subtitle:c.join(" • "),selected:W.compareVoice(i,o),onSelect:function(){n.voice.set(i),Lampa.Player.loading(!0),n.extract.voice(e.sources).then((function(i){i.sources=e.sources,n.tv(i,t,a)})).catch((function(e){})).finally((function(){Lampa.Player.loading(!1)}))}})}(s,c)}r.length>0&&!r.find((function(e){return e.selected}))&&(r[0].selected=!0),t.forEach((function(t){if(e.plays.find((function(e){return e.e==t.number}))){var o={number:t.number,title:t.title,timeline:t.timeline,launch_player:"inner",url:function(a){var i=W.player(),l=E(),s=(j(),l||"inner"!=i);e.plays.filter((function(e){return e.e==t.number}));if(s)W.selectChoiceTranstale(e.translates,W.voice(r.find((function(e){return e.selected}))),(function(a){n.voice.set(W.voice(a)),n.extract.voice(e.sources).then((function(e){var a=e.plays.filter((function(e){return e.e==t.number}));return n.extract.links([a])})).then((function(e){if(0==e.length)throw new Error(700);var a=n.getQuality(e),i=e.find((function(e){return e.subtitles})),r=n.extract.flows(a);W.selectChoiceFlow(r,(function(e){var a={title:t.title,url:e.url,timeline:t.timeline,subtitles:!!i&&i.subtitles};t.mark(),Lampa.Player.play(a)}))})).catch((function(e){n.extract.error(e)}))}));else if("inner"==i){Lampa.Player.loading(!0);var c=r.find((function(e){return e.selected})),u=c?c.name:"";n.extract.links([e.plays.filter((function(e){return e.e==t.number&&W.compareVoice(e.translate_name,u)}))]).then((function(e){0==e.length?(o.url="nofound",a()):(o.quality=n.getQuality(e),o.url=Lampa.Player.getUrlQuality(o.quality),a(),setTimeout((function(){n.setFlowsForQuality({url:"string"==typeof o.url?o.url:"",quality:o.quality,quality_switched:null})}),100))})).catch((function(){o.url="nofound",a()})).finally((function(){Lampa.Player.loading(!1)}))}},card:n.object.movie,voiceovers:r,callback:function(){t.mark(),a=t},error:function(e,t){n.on_error_timer=setTimeout((function(){n.getNextVoice(e,r,t)}),2e3)}};i.push(o)}}));var u=i.find((function(e){return e.number==a.number}));if(!u)return W.modalChoiceTranstale({from:r.find((function(e){return e.selected})).name,voicelist:r});u.url((function(){Lampa.Player.opened()&&Lampa.Player.close(),Lampa.Player.runas("inner"),Lampa.Player.play(u),Lampa.Player.playlist(i),u.quality&&Object.keys(u.quality).length>0&&n.setFlowsForQuality({url:"string"==typeof u.url?u.url:"",quality:u.quality,quality_switched:null})}))}}]),e}(),ae=function(){function e(a){t(this,e);this.object=a,this.startPlay()}return n(e,[{key:"startPlay",value:function(){this.object.movie.name?(v=this.object.movie.id||null,this.tv()):(v=null,this.movie())}},{key:"movie",value:function(){var e=this,t=new te(this.object);!function(){P();var a=function(){var n=A(),i=new Y(e.object);i.movie({movie:e.object.movie,type:"movie"}).then((function(a){P(),Lampa.Favorite.add("history",e.object.movie,100),t.movie(a)})).catch((function(e){T(n),q()?(Lampa.Noty.show("Пробуем другой сервер..."),a()):(P(),i.error(e))}))};a()}()}},{key:"tv",value:function(){Lampa.Activity.push({url:"",title:"",component:"episodes",movie:this.object.movie,page:1})}}]),e}(),ne={};function ie(e){var t,a=new Lampa.Explorer(e),n=new Lampa.Filter(e),i=new Lampa.Scroll({mask:!0,over:!0}),r={season:1},o=e.movie.number_of_seasons||1,s=!1,c=!1,u=null,m=null;this.create=function(){var t=this;this.getChoice(),a.appendFiles(i.render()),a.appendHead(n.render()),i.body().addClass("torrent-list mapping--list"),a.render().find(".filter--search, .filter--sort").remove(),i.minus(a.render().find(".explorer__files-head")),this.activity.loader(!0);var u=e.movie.id,m=e.movie.imdb_id,f=e.movie.tvdb_id,d=l.getSeasonsCount(u);function p(){s||Lampa.Api.seasons(e.movie,[1],(function(e){if(!s){if(e[1]&&e[1].seasons_count&&e[1].seasons_count>o&&(o=e[1].seasons_count),!c){var a=l.getSeasonsCount(u);a&&a>o&&(o=a)}s=!0,t.filter(),t.selected(),t.activity.loader(!1),e[1]&&e[1].episodes&&e[1].episodes.length&&1===r.season?t.draw(e[1].episodes):t.load()}}))}return d?(o=d,c=!0,p()):(l.fetch(u,m,f,(function(e){c=!0,e&&e>o&&(o=e),p()})),setTimeout((function(){s||p()}),3e3)),this.activity.toggle(),this.render()},this.setChoice=function(t){r.season=t;var a=Lampa.Storage.cache("season_choice","{}",1e3);a[e.movie.id]=t,Lampa.Storage.set("season_choice",a)},this.getChoice=function(){var t=Lampa.Storage.get("season_choice","{}");t[e.movie.id]&&(r.season=Math.max(1,t[e.movie.id]),s&&r.season>o&&(r.season=o))},this.filter=function(){var e=this;n.addButtonBack(),n.onSelect=function(t,a){e.setChoice(a.season),e.selected(),u=null,m=null,Lampa.Controller.toggle("content"),e.load()},n.onBack=function(){e.start()}},this.selected=function(){var e=[],t=[];for(var a in r)"season"==a&&e.push(Lampa.Lang.translate("torrent_serial_season")+": "+r[a]);for(var i=0;i<o;i++)t.push({title:Lampa.Lang.translate("torrent_serial_season")+" "+(i+1),season:i+1,selected:r.season==i+1});n.set("filter",t),n.chosen("filter",e)},this.load=function(){var a=this;this.activity.loader(!0);var n=r.season;Lampa.Api.clear(),Lampa.Api.seasons(e.movie,[n],(function(e){t=!1,i.clear(),i.reset(),e[n]&&e[n].episodes&&e[n].episodes.length?a.draw(e[n].episodes):a.empty(),a.activity.loader(!1)}))},this.empty=function(){var e=Lampa.Template.get("empty_filter"),t=$('<div class="simple-button selector"><span>'+Lampa.Lang.translate("filter_clarify")+"</span></div>");t.on("hover:enter",(function(){n.render().find(".filter--filter").trigger("hover:enter")})),e.find(".empty-filter__title").remove(),e.find(".empty-filter__buttons").removeClass("hide").append(t),i.append(e),Lampa.Controller.enable("content")},this.draw=function(a){a.forEach((function(n,o){var s=n.episode_number||o+1,c=Lampa.Utils.hash([r.season,r.season>10?":":"",s,e.movie.original_title].join("")),f=[],d=new Date((n.air_date+"").replace(/-/g,"/")),p=Date.now(),h=n.air_date?Math.round((d.getTime()-p)/864e5):1,v=Lampa.Lang.translate("full_episode_days_left")+": "+(n.air_date?h:"- -");n.timeline=Lampa.Timeline.view(c),n.time=Lampa.Utils.secondsToTime(60*n.runtime,!0),n.title=n.name||Lampa.Lang.translate("torrent_serial_episode")+" "+s,n.quality=h>0?v:"",n.number=s,n.vote_average&&f.push(Lampa.Template.get("season_episode_rate",{rate:parseFloat(n.vote_average+"").toFixed(1)},!0)),n.air_date&&f.push(Lampa.Utils.parseTime(n.air_date).full),n.info=f.length?f.map((function(e){return"<span>"+e+"</span>"})).join('<span class="season-episode-split">●</span>'):"";var y=Lampa.Template.get("season_episode",n),g=y.find(".season-episode__loader"),_=y.find(".season-episode__img"),k=function(e){y.find(".season-episode__viewed").remove(),(Boolean(n.timeline.percent)||e)&&y.find(".season-episode__img").append('<div class="season-episode__viewed">'+Lampa.Template.get("icon_viewed",{},!0)+"</div>")};n.mark=function(){t=y[0],k(!0)},n.unmark=function(){y.find(".season-episode__viewed").remove()},n.timeclear=function(){n.timeline.percent=0,n.timeline.time=0,n.timeline.duration=0,Lampa.Timeline.update(n.timeline),y.find(".season-episode__timeline").empty().append(Lampa.Timeline.render(n.timeline))},y.find(".season-episode__timeline").append(Lampa.Timeline.render(n.timeline)),h>0?y.css("opacity","0.5"):(k(),Boolean(n.timeline.percent)&&(t=y[0]),y.on("hover:enter",(function(){var o=new te(e),l=e.movie.id+"_"+r.season;if(u&&m===r.season)return Lampa.Favorite.add("history",e.movie,100),o.tv(u,a,n),n.mark(),void Lampa.Player.callback((function(){i.update($(t),!0),Lampa.Controller.toggle("content")}));if(ne[l])return u=ne[l],m=r.season,Lampa.Favorite.add("history",e.movie,100),o.tv(u,a,n),n.mark(),void Lampa.Player.callback((function(){i.update($(t),!0),Lampa.Controller.toggle("content")}));!function(){P();var c=function(){var f=A(),d=new Y(e);d.tv({movie:e.movie,season:r.season,episode:s,type:"episode"}).then((function(s){P(),u=s,m=r.season,ne[l]=s,Lampa.Favorite.add("history",e.movie,100),o.tv(s,a,n),n.mark(),Lampa.Player.callback((function(){i.update($(t),!0),Lampa.Controller.toggle("content")}))})).catch((function(e){T(f),q()?(Lampa.Noty.show("Пробуем другой сервер..."),c()):(P(),d.error(e))}))};c()}()}))),y.on("hover:focus",(function(e){t=e.target,i.update($(e.target),!0)})).on("visible",(function(){var e=y.find("img")[0];e.onerror=function(){e.src="./img/img_broken.svg"},e.onload=function(){_.addClass("season-episode__img--loaded"),g.remove(),_.append('<div class="season-episode__episode-number">'+("0"+s).slice(-2)+"</div>")},n.still_path?e.src=Lampa.TMDB.image("t/p/w300"+n.still_path):n.img?e.src=n.img:(g.remove(),_.append('<div class="season-episode__episode-number">'+("0"+s).slice(-2)+"</div>"))})).on("hover:hover hover:touch",(function(e){t=e.target,Navigator.focused(t)})).on("hover:long",(function(){var e=Lampa.Controller.enabled().name,t=[];t.push({title:Lampa.Lang.translate("skazfix_mark"),mark:!0}),t.push({title:Lampa.Lang.translate("skazfix_unmark"),unmark:!0}),t.push({title:Lampa.Lang.translate("skazfix_timeclear"),timeclear:!0}),t.push({title:Lampa.Lang.translate("skazfix_more"),separator:!0}),t.push({title:Lampa.Lang.translate("skazfix_clearallmark"),clearallmark:!0}),t.push({title:Lampa.Lang.translate("skazfix_clearalltime"),clearalltime:!0}),t.push({title:Lampa.Lang.translate("skazfix_reset_section"),separator:!0}),j()&&t.push({title:Lampa.Lang.translate("skazfix_reset_remembered"),resetremembered:!0}),t.push({title:Lampa.Lang.translate("skazfix_clear_cache"),clearcache:!0}),Lampa.Select.show({title:Lampa.Lang.translate("skazfix_action"),items:t,onBack:function(){Lampa.Controller.toggle(e)},onSelect:function(t){Lampa.Controller.toggle(e),t.mark&&n.mark(),t.unmark&&n.unmark(),t.timeclear&&n.timeclear(),t.clearallmark&&a.forEach((function(e){e.unmark&&e.unmark()})),t.clearalltime&&a.forEach((function(e){e.timeclear&&e.timeclear()})),t.resetremembered&&(I(),Lampa.Noty.show(Lampa.Lang.translate("skazfix_remembered_reset_done"))),t.clearcache&&(Object.keys(ne).forEach((function(e){delete ne[e]})),u=null,m=null,l.cache={},Lampa.Noty.show(Lampa.Lang.translate("skazfix_cache_cleared")))}})})),i.append(y)})),t&&i.update($(t),!0),Lampa.Layer.visible(i.render(!0)),Lampa.Controller.enable("content")},this.start=function(){Lampa.Activity.active().activity===this.activity&&(Lampa.Background.immediately(Lampa.Utils.cardImgBackgroundBlur(e.movie)),Lampa.Controller.add("content",{toggle:function(){Lampa.Controller.collectionSet(i.render(),a.render()),Lampa.Controller.collectionFocus(t||!1,i.render())},left:function(){a.toggle()},right:function(){n.show(Lampa.Lang.translate("title_filter"),"filter")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:function(){Lampa.Activity.backward()}}),Lampa.Controller.toggle("content"))},this.pause=function(){},this.stop=function(){},this.render=function(){return a.render()},this.destroy=function(){i.destroy(),n.destroy(),a.destroy();try{Lampa.Api.clear()}catch(e){}}}function re(){Lampa.Settings.listener.follow("open",(function(e){"main"==e.name&&(0==Lampa.Settings.main().render().find('[data-component="online_settings"]').length&&Lampa.SettingsApi.addComponent({component:"online_settings",name:Lampa.Lang.translate("skazfix_online_title"),icon:y,before:"interface"}),Lampa.Settings.main().update())})),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_mode_title",type:"title"},field:{name:Lampa.Lang.translate("skazfix_work_mode")}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_always_show_choices_toggle",type:"trigger",default:!1},field:{name:Lampa.Lang.translate("skazfix_always_show_choices"),description:Lampa.Lang.translate("skazfix_always_show_choices_desc")},onChange:function(e){F(e)},onRender:function(e){e.find(".settings-param__value").text(E()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no")),e.on("hover:enter",(function(){F(!E()),e.find(".settings-param__value").text(E()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no"))}))}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_remember_choices_toggle",type:"trigger",default:!1},field:{name:Lampa.Lang.translate("skazfix_remember_choices"),description:Lampa.Lang.translate("skazfix_remember_choices_desc")},onChange:function(e){D(e)},onRender:function(e){e.find(".settings-param__value").text(j()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no")),e.on("hover:enter",(function(){D(!j()),j()||I(),e.find(".settings-param__value").text(j()?Lampa.Lang.translate("skazfix_yes"):Lampa.Lang.translate("skazfix_no"))}))}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_sources_title",type:"title"},field:{name:Lampa.Lang.translate("skazfix_sources_title")}}),Lampa.SettingsApi.addParam({component:"online_settings",param:{name:"online_sources_btn",type:"static"},field:{name:Lampa.Lang.translate("skazfix_choose_sources"),description:Lampa.Lang.translate("skazfix_choose_balancers")},onRender:function(e){e.on("hover:enter",(function(){oe()}))}})}function oe(e){var t=Lampa.Controller.enabled().name,a=L(),n=x(),i=[];i.push({title:Lampa.Lang.translate("skazfix_reset_default"),reset:!0}),g.forEach((function(e){if(e.enabled&&!e.anime){var t=Lampa.Arrays.isArray(e.id)?e.id[0]:e.id;i.push({title:e.name,source:t,checkbox:!0,checked:-1!==a.indexOf(t),isAnime:!1})}})),g.some((function(e){return e.enabled&&e.anime}))&&(i.push({title:Lampa.Lang.translate("skazfix_anime_title"),separator:!0}),g.forEach((function(e){if(e.enabled&&e.anime){var t=Lampa.Arrays.isArray(e.id)?e.id[0]:e.id;i.push({title:e.name,source:t,checkbox:!0,checked:-1!==n.indexOf(t),isAnime:!0})}}))),Lampa.Select.show({title:Lampa.Lang.translate("skazfix_choose_sources"),items:i,onBack:function(){var a=i.filter((function(e){return e.checkbox&&e.checked&&!e.isAnime})).map((function(e){return e.source})),n=i.filter((function(e){return e.checkbox&&e.checked&&e.isAnime})).map((function(e){return e.source}));0===a.length&&(a=_()),0===n.length&&(n=k()),b(a),S(n),Lampa.Controller.toggle(t),e&&e()},onSelect:function(t){if(!t.separator){if(t.reset){var a=_(),n=k();return i.forEach((function(e){e.checkbox&&!e.isAnime&&(e.checked=-1!==a.indexOf(e.source)),e.checkbox&&e.isAnime&&(e.checked=-1!==n.indexOf(e.source))})),b(a),S(n),Lampa.Noty.show(Lampa.Lang.translate("skazfix_sources_reset")),Lampa.Select.close(),void oe(e)}t.checked=!t.checked}}})}!function(){if(!window.plugin_init){window.plugin_init=!0,re(),Lampa.Component.add("episodes",ie),Lampa.VPN.region((function(){})),Lampa.Listener.follow("full",(function(e){if("complite"==e.type){var t='<div class="full-start__button selector view--online">'+y+"<span>"+Lampa.Lang.translate("skazfix_online")+"</span></div>",a=$(Lampa.Lang.translate(t));e.object.activity.render().find(".view--torrent").after(a),a.on("hover:enter",(function(){Lampa.Controller.toggle("content"),new ae(e.data)}))}}));$("body").append("\n\t\t\t<style>\n\t\t\t\t.connect-broken {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tpadding-bottom: 1em;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__title {\n\t\t\t\t\tfont-size: 2em;\n\t\t\t\t\tline-height: 1.4;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__text {\n\t\t\t\t\tfont-size: 1.2em;\n\t\t\t\t\tpadding-top: 1em;\n\t\t\t\t\tline-height: 1.4;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__footer {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmargin-top: 2em;\n\t\t\t\t}\n\n\t\t\t\t.connect-broken__footer .simple-button {\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\n\t\t\t\t.selectbox-item__subtitle {\n\t\t\t\t\topacity: 0.5;\n\t\t\t\t}\n\t\t\t</style>\n\t\t")}}()}();
